<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Duty Tracker Pro</title>
    
    <!-- PWA -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#050505">

    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <!-- SDKs -->
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <script src="https://www.paypal.com/sdk/js?client-id=AfOzNhmiQjamiR4usKOUs_hullqnPZaXSTks076L48mXJJaMAn3Rblux_KJsP6_D20xX3s37hnns4p2R&currency=USD"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <style>
        :root {
            --primary: #6C63FF;
            --secondary: #00F0FF;
            --accent: #FF0055;
            --dark-bg: #050505;
            --surface: #121212;
            --glass: rgba(255, 255, 255, 0.08);
            --border: rgba(255, 255, 255, 0.15);
            --gradient: linear-gradient(135deg, #6C63FF, #00F0FF);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Outfit', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background-color: var(--dark-bg); background-image: radial-gradient(circle at 50% 50%, rgba(108, 99, 255, 0.12) 0%, transparent 60%); color: #ffffff; overflow-x: hidden; min-height: 100vh; display: flex; flex-direction: column; }

        /* --- SPLASH SCREEN --- */
        #splash { 
            position: fixed; inset: 0; width: 100%; height: 100%; 
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            z-index: 9999999; display: flex; align-items: center; justify-content: center; text-align: center;
            transition: opacity 0.8s ease-out;
        }
        .splash-content { display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .splash-logo-icon { font-size: 100px !important; background: var(--gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 20px; animation: pulse 2s infinite; filter: drop-shadow(0 0 15px rgba(108, 99, 255, 0.6)); }
        .splash-title { font-size: 32px; font-weight: 800; color: white; margin-bottom: 30px; }
        .loader { width: 50px; height: 50px; border: 5px solid rgba(255,255,255,0.1); border-top-color: var(--secondary); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto; }
        .splash-footer { position: absolute; bottom: 30px; text-align: center; width: 100%; }

        @keyframes spin { to { transform: rotate(360deg); } }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.08); } }

        /* --- AUTH SCREEN --- */
        #auth-screen { position: fixed; inset: 0; width: 100%; height: 100%; background-color: var(--dark-bg); z-index: 5000; display: none; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
        .auth-box { background: var(--glass); padding: 40px 30px; max-width: 400px; width: 100%; border-radius: 28px; text-align: center; border: 1px solid var(--border); box-shadow: 0 0 50px rgba(108, 99, 255, 0.2); }
        .auth-inp { width: 100%; padding: 16px; margin: 0; border-radius: 12px; border: 1px solid #333; background: #000; color: white; text-align: center; font-size: 18px; outline: none; margin-bottom: 20px; }
        .action-btn { width: 100%; padding: 16px; border-radius: 50px; border: none; background: var(--gradient); color: white; font-weight: bold; cursor: pointer; font-size: 16px; transition: 0.3s; margin-top: 20px; }

        /* --- MAIN UI --- */
        #main-app { display: none; flex-direction: column; flex: 1; }
        nav { display: flex; justify-content: space-between; align-items: center; padding: 15px 5%; position: sticky; top: 0; z-index: 1000; background: rgba(5, 5, 5, 0.9); backdrop-filter: blur(15px); border-bottom: 1px solid var(--border); }
        .logo { font-size: 20px; font-weight: 800; background: var(--gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        #pwa-install-btn { background: var(--gradient); border: none; color: white; padding: 8px 16px; border-radius: 50px; font-size: 11px; font-weight: bold; cursor: pointer; display: none; }

        /* CALENDAR */
        .app-header { padding: 20px; display: flex; justify-content: space-between; align-items: center; }
        #calendar-grid { padding: 10px; display: grid; grid-template-columns: repeat(7, 1fr); gap: 6px; }
        .day-cell { height: 85px; background: rgba(255,255,255,0.05); border-radius: 14px; border: 1px solid transparent; transition: 0.2s; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; }
        .day-num { font-weight: bold; font-size: 16px; }
        .bg-Present { background: #4caf50 !important; color: white; }
        .bg-Leave { background: #f44336 !important; color: white; }
        .bg-Sick { background: #ff9800 !important; color: white; }
        .bg-Holiday { background: #9c27b0 !important; color: white; }
        .bg-Off { background: #607d8b !important; color: white; opacity: 0.7; }

        /* PAGES */
        .full-page { position: fixed; inset: 0; width: 100%; height: 100%; background: var(--dark-bg); z-index: 3000; display: none; flex-direction: column; overflow-y: auto; }
        .fp-head { padding: 20px; border-bottom: 1px solid var(--border); display: flex; align-items: center; gap: 15px; background: rgba(0,0,0,0.8); }
        .fp-body { padding: 20px; padding-bottom: 150px; }
        .profile-card { background: linear-gradient(135deg, rgba(108, 99, 255, 0.2), rgba(0, 240, 255, 0.2)); padding: 25px; border-radius: 20px; border: 1px solid var(--border); margin-bottom: 25px; text-align: center; }
        .sub-badge { background: var(--accent); color: white; padding: 6px 14px; border-radius: 20px; font-size: 11px; font-weight: bold; text-transform: uppercase; }

        /* UPDATE LINK BOX */
        .update-box { background: rgba(0, 240, 255, 0.1); border: 1px solid var(--secondary); padding: 15px; border-radius: 16px; margin-bottom: 25px; display: flex; align-items: center; justify-content: space-between; cursor: pointer; animation: pulse 2s infinite; }
        
        /* DONATE SECTION */
        #donate-box { background: rgba(255, 255, 255, 0.05); border-radius: 20px; padding: 25px; margin: 25px 0; border: 1px solid var(--secondary); text-align: center; }
        .donate-badges { display: flex; flex-wrap: wrap; justify-content: center; gap: 12px; margin-top: 20px; }
        .donate-badges img { height: 42px; border-radius: 8px; cursor: pointer; }

        /* LEGAL SECTION */
        .legal-btn { width: 100%; padding: 15px; text-align: left; background: rgba(255,255,255,0.05); border: 1px solid var(--border); margin-bottom: 10px; color: #ccc; border-radius: 12px; display: flex; justify-content: space-between; cursor: pointer; }
        .legal-btn:hover { background: rgba(255,255,255,0.1); color: white; }

        #modal { position: fixed; bottom: 0; width: 100%; background: #111; padding: 25px; border-radius: 30px 30px 0 0; display: none; z-index: 2000; border-top: 1px solid var(--border); }
        .type-btn { padding: 12px; margin: 5px; background: #222; color: white; border: 1px solid #333; border-radius: 8px; width: 30%; font-weight: bold; }
        .type-btn.active { border-color: var(--secondary); background: rgba(0, 240, 255, 0.1); }
        
        .bottom-bar { position: fixed; bottom: 20px; left: 0; width: 100%; display: flex; justify-content: center; gap: 15px; z-index: 500; }
        .bar-btn { padding: 12px 25px; border-radius: 50px; border: 1px solid var(--border); background: rgba(255,255,255,0.1); color: white; font-weight: bold; backdrop-filter: blur(10px); }

        #payment-screen { position: fixed; inset: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.98); backdrop-filter: blur(25px); z-index: 99999; display: none; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
        .lock-card { background: #111; padding: 25px; border-radius: 24px; border: 1px solid var(--accent); max-width: 400px; width: 100%; }
        .paypal-container { width: 100%; margin-top: 15px; min-height: 50px; }

        #legal-modal { position: fixed; inset: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 5000; display: none; justify-content: center; align-items: center; padding: 20px; }
        .legal-content { background: #151515; width: 100%; max-width: 500px; border-radius: 20px; border: 1px solid var(--border); max-height: 80vh; overflow-y: auto; padding: 25px; position: relative; color: #ccc; line-height: 1.6; }
        .legal-close { position: absolute; top: 15px; right: 15px; background: none; border: none; color: white; font-size: 20px; cursor: pointer; }
    </style>
</head>
<body>

    <!-- 1. SPLASH SCREEN -->
    <div id="splash">
        <div class="splash-content">
            <span class="material-icons splash-logo-icon">assignment_ind</span>
            <div class="splash-title">Duty Tracker Pro</div>
            <div class="loader"></div>
        </div>
        <div class="splash-footer">
            <div style="font-size:14px; color:#ccc;">Developer By <b>Nitai Studio</b></div>
            <div style="font-size:12px; color:#888; display:flex; align-items:center; justify-content:center; gap:6px; margin-top:5px;">Made in India <img src="https://flagcdn.com/w40/in.png" alt="India Flag" style="width:20px;"></div>
        </div>
    </div>

    <!-- 2. AUTH SCREEN -->
    <div id="auth-screen">
        <div class="auth-box">
            <i class="fas fa-fingerprint" style="font-size:60px; color:var(--primary); margin-bottom:20px;"></i>
            <h2 style="margin-bottom:10px;">Sign In</h2>
            <div style="display:flex; gap:10px; margin:25px 0;">
                <select id="country-code" style="padding:15px; border-radius:14px; background:#000; color:white; border:1px solid #333; width:100px; outline:none;">
                    <option value="+91">ğŸ‡®ğŸ‡³ +91</option><option value="+880">ğŸ‡§ğŸ‡© +880</option><option value="+1">ğŸ‡ºğŸ‡¸ +1</option><option value="+44">ğŸ‡¬ğŸ‡§ +44</option>
                    <option value="+971">ğŸ‡¦ğŸ‡ª +971</option><option value="+966">ğŸ‡¸ğŸ‡¦ +966</option><option value="+60">ğŸ‡²ğŸ‡¾ +60</option><option value="+65">ğŸ‡¸ğŸ‡¬ +65</option>
                    <option value="+61">ğŸ‡¦ğŸ‡º +61</option><option value="+1">ğŸ‡¨ğŸ‡¦ +1</option><option value="+49">ğŸ‡©ğŸ‡ª +49</option><option value="+33">ğŸ‡«ğŸ‡· +33</option>
                    <option value="+39">ğŸ‡®ğŸ‡¹ +39</option><option value="+81">ğŸ‡¯ğŸ‡µ +81</option><option value="+82">ğŸ‡°ğŸ‡· +82</option><option value="+7">ğŸ‡·ğŸ‡º +7</option>
                    <option value="+31">ğŸ‡³ğŸ‡± +31</option><option value="+34">ğŸ‡ªğŸ‡¸ +34</option><option value="+41">ğŸ‡¨ğŸ‡­ +41</option><option value="+90">ğŸ‡¹ğŸ‡· +90</option>
                    <option value="+27">ğŸ‡¿ğŸ‡¦ +27</option><option value="+55">ğŸ‡§ğŸ‡· +55</option><option value="+52">ğŸ‡²ğŸ‡½ +52</option><option value="+62">ğŸ‡®ğŸ‡© +62</option>
                    <option value="+63">ğŸ‡µğŸ‡­ +63</option><option value="+84">ğŸ‡»ğŸ‡³ +84</option><option value="+66">ğŸ‡¹ğŸ‡­ +66</option><option value="+92">ğŸ‡µğŸ‡° +92</option>
                    <option value="+94">ğŸ‡±ğŸ‡° +94</option><option value="+977">ğŸ‡³ğŸ‡µ +977</option><option value="+975">ğŸ‡§ğŸ‡¹ +975</option><option value="">ğŸŒ Other</option>
                </select>
                <input type="number" id="auth-phone" class="auth-inp" placeholder="Mobile Number" style="margin:0; flex:1;">
            </div>
            <button class="action-btn" onclick="app.login()">Verify & Get Started</button>
        </div>
    </div>

   <!-- 3. PAYMENT SCREEN -->
    <div id="payment-screen">
        <div class="lock-card">
            <button id="pay-close-btn" style="position:absolute; top:15px; right:15px; background:rgba(255,255,255,0.1); border:none; color:white; width:30px; height:30px; border-radius:50%; display:flex; align-items:center; justify-content:center; cursor:pointer;" onclick="document.getElementById('payment-screen').style.display='none'">
                <i class="fas fa-times"></i>
            </button>
            
            <i class="fas fa-crown" style="font-size:50px; color:var(--accent); margin-bottom:15px; display:block; text-align:center;"></i>
            <h2 style="margin-bottom:10px; color:white; text-align:center;">Premium Access</h2>
            <p style="color:#aaa; font-size:13px; margin-bottom:25px; text-align:center;">Renew subscription to continue tracking your duties.</p>
            
            <div class="plan-box" style="background:rgba(255,255,255,0.05); border:1px solid var(--border); border-radius:16px; padding:15px; margin-bottom:15px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                    <b style="color:white; font-size:16px;">Monthly Plan</b> 
                    <span style="color:var(--secondary); font-weight:800;">â‚¹5 / $0.10</span>
                </div>
                <button class="pay-btn-rzp" style="width:100%; padding:12px; background:#3399cc; color:white; border:none; border-radius:8px; font-weight:bold; cursor:pointer; display:flex; align-items:center; justify-content:center; gap:8px;" onclick="pay.razorpay(5, 'monthly')">
                    <i class="fas fa-bolt"></i> Pay with Razorpay
                </button>
                <div id="paypal-btn-monthly" class="paypal-container" style="margin-top:10px; min-height:45px;"></div>
            </div>

            <div class="plan-box" style="background:rgba(255,255,255,0.05); border:1px solid var(--border); border-radius:16px; padding:15px; margin-bottom:15px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                    <b style="color:white; font-size:16px;">Yearly Plan</b> 
                    <span style="color:var(--secondary); font-weight:800;">â‚¹40 / $0.50</span>
                </div>
                <button class="pay-btn-rzp" style="width:100%; padding:12px; background:#3399cc; color:white; border:none; border-radius:8px; font-weight:bold; cursor:pointer; display:flex; align-items:center; justify-content:center; gap:8px;" onclick="pay.razorpay(40, 'yearly')">
                    <i class="fas fa-bolt"></i> Pay with Razorpay
                </button>
                <div id="paypal-btn-yearly" class="paypal-container" style="margin-top:10px; min-height:45px;"></div>
            </div>
        </div>
    </div>

    <!-- 4. MAIN APP -->
    <div id="main-app">
        <nav>
            <div class="logo">Duty Tracker</div>
            <button id="pwa-install-btn" onclick="pwa.install()">INSTALL APP</button>
        </nav>
        <div class="app-header">
            <button onclick="cal.move(-1)" style="background:none; border:none; color:white;"><i class="fas fa-chevron-left" style="font-size:24px;"></i></button>
            <h3 id="month-txt">...</h3>
            <button onclick="cal.move(1)" style="background:none; border:none; color:white;"><i class="fas fa-chevron-right" style="font-size:24px;"></i></button>
        </div>
        <div style="display:grid; grid-template-columns:repeat(7,1fr); text-align:center; font-size:12px; font-weight:bold; margin-bottom:10px; color:#aaa; padding:0 15px;"><div>S</div><div>M</div><div>T</div><div>W</div><div>T</div><div>F</div><div>S</div></div>
        <div id="calendar-grid" style="padding:0 10px;"></div>
        
        <div class="bottom-bar">
            <button onclick="reports.open()" class="bar-btn"><i class="fas fa-chart-pie"></i> Reports</button>
            <button onclick="ui.openProfile()" class="bar-btn"><i class="fas fa-user-circle"></i> Profile</button>
        </div>
    </div>

    <!-- MODAL -->
    <div id="modal">
        <h3 id="modal-date" style="text-align:center; margin-bottom:20px;">Date</h3>
        <div class="type-grid">
            <button class="type-btn" onclick="data.set('Present', this)">Present</button>
            <button class="type-btn" onclick="data.set('Leave', this)">Leave</button>
            <button class="type-btn" onclick="data.set('Sick', this)">Sick</button>
            <button class="type-btn" onclick="data.set('Holiday', this)">Holiday</button>
            <button class="type-btn" onclick="data.set('Off', this)">Off</button>
        </div>
        <div style="margin-top:20px; display:flex; gap:15px;">
            <input type="number" id="inp-ot" placeholder="OT (Hrs)" class="auth-inp" style="width:50%; margin:0; border-radius:12px;">
            <input type="number" id="inp-late" placeholder="Late (Min)" class="auth-inp" style="width:50%; margin:0; border-radius:12px;">
        </div>
        <button class="action-btn" onclick="data.save()">Save Status</button>
        <button class="action-btn" style="background: #d32f2f; margin-top:10px;" onclick="data.clear()">ğŸ—‘ï¸ Clear Entry</button>
        <button onclick="document.getElementById('modal').style.display='none'" style="width:100%; color:#aaa; background:none; border:none; margin-top:15px; font-weight:bold;">Cancel</button>
    </div>

    <!-- PROFILE & SETTINGS -->
    <div id="settings" class="full-page">
        <div class="fp-head"><i class="fas fa-arrow-left" onclick="this.parentElement.parentElement.style.display='none'" style="font-size:24px;"></i> <h3>Profile & Settings</h3></div>
        <div class="fp-body">
            <div class="profile-card">
                <i class="fas fa-user-circle" style="font-size:60px; color:var(--secondary); margin-bottom:15px;"></i>
                <h3 id="prof-id">...</h3>
                <div style="margin:10px 0;"><span class="sub-badge" id="prof-status">TRIAL</span></div>
                <p id="prof-exp" style="font-size:13px; color:#aaa; margin-bottom:20px;">Expires on: ...</p>
                <button class="action-btn" id="extend-btn" style="background:var(--accent); font-size:14px;" onclick="pay.showPaymentScreen(false)">âš¡ Buy Premium</button>
            </div>

            <!-- NEW: APP UPDATE LINK -->
            <div class="update-box" onclick="window.open('https://dutytrackerpro.blogspot.com/?m=1', '_blank')">
                <div style="display:flex; align-items:center; gap:10px;">
                    <i class="fas fa-rocket" style="color:var(--secondary); font-size:20px;"></i>
                    <div style="text-align:left;">
                        <div style="color:white; font-weight:bold;">App Update Available</div>
                        <div style="color:#aaa; font-size:12px;">Get the latest version</div>
                    </div>
                </div>
                <i class="fas fa-external-link-alt" style="color:var(--secondary);"></i>
            </div>

            <h4 style="color:var(--primary); margin-bottom:15px;">Preferences</h4>
            <div style="background:var(--glass); border-radius:16px; padding:20px; border:1px solid var(--border);">
                <label style="font-size:12px; color:#666;">Currency</label>
                <select id="set-cur" class="auth-inp" style="margin:5px 0 15px; text-align:left;"><option value="à§³">à§³ (BDT)</option><option value="â‚¹">â‚¹ (INR)</option><option value="$">$ (USD)</option></select>
                <label style="font-size:12px; color:#666;">Daily Salary</label>
                <input type="number" id="set-sal" class="auth-inp" style="margin:5px 0 15px; text-align:left;" placeholder="0">
                <label style="font-size:12px; color:#666;">Overtime Rate (Hour)</label>
                <input type="number" id="set-otr" class="auth-inp" style="margin:5px 0 20px; text-align:left;" placeholder="0">
                <button class="action-btn" onclick="settings.save()">Save Configuration</button>
            </div>

            <!-- DONATE BOX -->
            <div id="donate-box">
                <h4 style="color:white; margin:10px 0; text-align:center;">Support Development â¤ï¸</h4>
                <div class="donate-badges">
                    <a href="https://buymeacoffee.com/nitaigrp00a" target="_blank"><img src="https://img.shields.io/badge/Buy_Me_a_Coffee-FFDD00?logo=buy-me-a-coffee&logoColor=black&style=for-the-badge"></a>
                    <a href="https://ko-fi.com/nitaisarkar" target="_blank"><img src="https://img.shields.io/badge/Ko--fi-Support_Me-FF5E5B?logo=ko-fi&logoColor=white&style=for-the-badge"></a>
                    <a href="https://www.patreon.com/cw/NitaiStudio" target="_blank"><img src="https://img.shields.io/badge/Patreon-Support_Me-F96854?logo=patreon&logoColor=white&style=for-the-badge"></a>
                </div>
            </div>

            <h4 style="color:white; margin:30px 0 15px;">Legal & Support</h4>
            <button class="legal-btn" onclick="legal.show('privacy')"><span>Privacy Policy</span> <i class="fas fa-chevron-right"></i></button>
            <button class="legal-btn" onclick="legal.show('refund')"><span>Refund Policy</span> <i class="fas fa-chevron-right"></i></button>
            <button class="legal-btn" onclick="legal.show('terms')"><span>Disclaimer</span> <i class="fas fa-chevron-right"></i></button>
            <button class="legal-btn" onclick="location.href='mailto:nitai.grp00@gmail.com'"><span>Contact Support</span> <i class="fas fa-envelope"></i></button>

            <!-- NEW: LOGOUT BUTTON -->
            <button class="action-btn" style="background: #222; margin-top: 30px; border: 1px solid #333;" onclick="app.logout()">
                <i class="fas fa-sign-out-alt"></i> Logout
            </button>
        </div>
    </div>

    <!-- REPORTS -->
    <div id="reports" class="full-page">
        <div class="fp-head"><i class="fas fa-arrow-left" onclick="this.parentElement.parentElement.style.display='none'"></i> <h3>Reports</h3></div>
        <div class="fp-body">
            <div style="display:flex; gap:10px; margin-bottom:15px;">
                <input type="date" id="r-start" class="auth-inp" style="margin:0; font-size:14px;">
                <input type="date" id="r-end" class="auth-inp" style="margin:0; font-size:14px;">
            </div>
            <button class="action-btn" onclick="reports.calc()">Generate</button>
            <div id="r-out" style="margin-top:20px;"></div>
        </div>
    </div>

    <!-- LEGAL MODAL -->
    <div id="legal-modal">
        <div class="legal-content">
            <button class="legal-close" onclick="document.getElementById('legal-modal').style.display='none'">&times;</button>
            <h3 id="legal-title">Policy</h3>
            <div id="legal-body" style="font-size:13px; color:#aaa;"></div>
        </div>
    </div>

    <script>
        // --- SECURITY ---
        (function() {
            var allowed = "nitaistudio.github.io"; 
            if (window.location.hostname && window.location.hostname !== allowed && window.location.hostname !== "localhost") {
                document.body.innerHTML = "<div style='height:100vh;display:flex;justify-content:center;align-items:center;background:#000;color:red;text-align:center;'><h1>ğŸš« Access Denied</h1></div>";
                throw new Error("Unauthorized");
            }
        })();

        // --- FIREBASE CONFIG ---
        const firebaseConfig = {
            apiKey: "AIzaSyDxqq2PBqrtkTsygyMcIDOvZyx2_-x4QRk",
            authDomain: "duty-tracker-pro.firebaseapp.com",
            databaseURL: "https://duty-tracker-pro-default-rtdb.firebaseio.com",
            projectId: "duty-tracker-pro",
            storageBucket: "duty-tracker-pro.firebasestorage.app",
            messagingSenderId: "716525293622",
            appId: "1:716525293622:web:880f39084c86180fbb0897"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const RZP_KEY = "rzp_live_Rz7kQ4RAloCWGp";

        const s = { uid: null, country: null, date: new Date(), data: {}, sub: 0, conf: { cur: 'à§³', sal: 0, otr: 0 } };
        let sel = { d: null, t: null };
        let paypalRendered = false;
        let deferredPrompt;

        // --- INITIALIZATION ---
        window.onload = () => {
            const id = localStorage.getItem('dt_id');
            const country = localStorage.getItem('dt_country');
            setTimeout(() => {
                document.getElementById('splash').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('splash').style.display = 'none';
                    if(id && country) { s.country = country; app.start(id); }
                    else document.getElementById('auth-screen').style.display = 'flex';
                }, 800);
            }, 3000);
        };

        const app = {
            login: () => {
                const code = document.getElementById('country-code').value;
                const num = document.getElementById('auth-phone').value.trim();
                if(num.length > 5) {
                    const fullId = code + num;
                    s.country = code;
                    localStorage.setItem('dt_id', fullId); localStorage.setItem('dt_country', code);
                    document.getElementById('auth-screen').style.display = 'none';
                    app.start(fullId);
                } else alert("Invalid Number");
            },
            logout: () => {
                if(confirm("Are you sure you want to logout?")) {
                    localStorage.removeItem('dt_id');
                    localStorage.removeItem('dt_country');
                    location.reload();
                }
            },
            start: (id) => { 
                s.uid = id;
                document.getElementById('main-app').style.display = 'flex';
                db.ref('u/' + s.uid).on('value', snap => {
                    const v = snap.val() || {};
                    s.data = v.att || {};
                    
                    if (!v.subExp) {
                        const trialEnd = Date.now() + (3 * 24 * 60 * 60 * 1000); 
                        db.ref('u/' + s.uid + '/subExp').set(trialEnd);
                        s.sub = trialEnd;
                    } else s.sub = v.subExp;

                    document.getElementById('extend-btn').style.display = 'block';
                    
                    if(Date.now() > s.sub) pay.showPaymentScreen(true);
                    else document.getElementById('payment-screen').style.display = 'none';

                    if(v.conf) {
                        s.conf = { ...s.conf, ...v.conf };
                        document.getElementById('set-cur').value = s.conf.cur || 'à§³';
                        document.getElementById('set-sal').value = s.conf.sal || '';
                        document.getElementById('set-otr').value = s.conf.otr || '';
                    }
                    cal.render();
                });
            }
        };

        const pay = {
            showPaymentScreen: (isLocked) => {
                document.getElementById('payment-screen').style.display = 'flex';
                document.getElementById('pay-close-btn').style.display = isLocked ? 'none' : 'flex';
                setTimeout(() => pay.initPayPal(), 100); 
            },
            razorpay: (amt, plan) => {
                const options = { "key": RZP_KEY, "amount": amt * 100, "currency": "INR", "name": "Duty Tracker Pro", "handler": function (r) { pay.success(plan); } };
                new Razorpay(options).open();
            },
            initPayPal: () => {
                if(paypalRendered) return;
                document.getElementById('paypal-btn-monthly').innerHTML = "";
                if (typeof paypal !== 'undefined') {
                    paypal.Buttons({ createOrder: (d, a) => a.order.create({ purchase_units: [{ amount: { value: '0.10' } }] }), onApprove: (d, a) => a.order.capture().then(() => pay.success('monthly')) }).render('#paypal-btn-monthly');
                    paypalRendered = true;
                }
            },
            success: (plan) => {
                const add = (plan === 'yearly') ? 31536000000 : 2592000000;
                db.ref('u/' + s.uid + '/subExp').set(Date.now() + add).then(() => location.reload());
            }
        };

        const legal = {
            show: (type) => {
                const titles = { 'privacy': 'Privacy Policy', 'refund': 'Refund Policy', 'terms': 'Disclaimer' };
                const texts = {
                    'privacy': 'Duty Tracker Pro respects and values the privacy of its users. This application is designed
as a productivity and utility tool for managing attendance, duty records, and salary
calculations.

Duty Tracker Pro offers optional premium subscription plans to enhance the user experience
and unlock advanced features. Subscriptions are available on a monthly or yearly basis and
are processed securely through Razorpay, an RBI-compliant payment gateway. Subscription
fees are clearly displayed within the application before payment. Premium features are
activated only after successful payment confirmation. Subscription plans are intended for
individual users and are non-transferable.

This application is privately developed and maintained. It is not affiliated with, endorsed
by, or associated with any government department, authority, or scheme.

We collect the userâ€™s mobile number solely for the purpose of account identification,
authentication, and secure data synchronization across devices. No government-issued
identity information such as Aadhaar number, PAN number, voter ID, or any other sensitive
personal data is collected by this application.

All duty records, attendance data, salary settings, and related information are stored
securely using Google Firebase infrastructure. Reasonable security measures are
implemented to protect user data against unauthorized access, alteration, or disclosure.

We do not sell, trade, or share any personal or sensitive user data with third parties.
User data is used strictly for application functionality, subscription management, and
service improvement purposes.

Users have the right to request access, correction, or deletion of their personal data.
Such requests can be made by contacting the support team through the contact details
provided within the application.

By using this application, you acknowledge and agree to the collection and use of
information in accordance with this Privacy Policy.',
                    'refund': 'All premium subscriptions offered within Duty Tracker Pro are digital services and are
activated instantly upon successful payment. Therefore, refunds are generally not provided.

However, in cases of technical failure, unsuccessful activation, or payment-related issues,
users may contact the support team within 24 hours of the transaction for assistance and
resolution.

Each request will be reviewed on a case-by-case basis to ensure fair handling in accordance
with applicable consumer protection guidelines.',
                    'terms': 'Duty Tracker Pro is provided as a utility and productivity tool intended to assist users in
tracking attendance, duty schedules, overtime, and salary calculations.

While every effort is made to ensure accuracy in calculations and data processing, the
application does not guarantee absolute accuracy. Salary figures, overtime amounts, and
other calculated values are indicative only.

The developer shall not be held responsible for any financial loss, discrepancies, or
decisions made based on the information provided by this application. Users are strongly
advised to independently verify all calculations and records before making any official or
financial decisions.

Use of this application is entirely at the userâ€™s own discretion and responsibility.'
                };
                document.getElementById('legal-title').innerText = titles[type];
                document.getElementById('legal-body').innerText = texts[type];
                document.getElementById('legal-modal').style.display = 'flex';
            }
        };

        const cal = {
            getIso: (y, m, d) => `${y}-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`,
            render: () => {
                const y=s.date.getFullYear(), m=s.date.getMonth();
                document.getElementById('month-txt').innerText = new Date(y, m).toLocaleString('default', { month: 'long', year: 'numeric' });
                const grid = document.getElementById('calendar-grid'); grid.innerHTML='';
                const fDay = new Date(y,m,1).getDay(), lDate = new Date(y,m+1,0).getDate();
                for(let i=0; i<fDay; i++) grid.innerHTML += `<div></div>`;
                for(let i=1; i<=lDate; i++) {
                    const iso = cal.getIso(y, m, i);
                    const ent = s.data[iso];
                    const el = document.createElement('div'); el.className = 'day-cell ' + (ent ? 'bg-'+ent.t : '');
                    if(iso === new Date().toISOString().split('T')[0]) el.style.border = '2px solid var(--secondary)';
                    el.innerHTML = `<span style="font-weight:bold">${i}</span>`;
                    if(ent) {
                        el.innerHTML += `<div style="font-size:10px; margin-top:5px; opacity:0.8">${ent.t}</div>`;
                        if(ent.ot) el.innerHTML += `<div style="font-size:9px; color:#ffff00">OT: ${ent.ot}</div>`;
                    }
                    el.onclick=()=> {
                        sel.d = iso; document.getElementById('modal-date').innerText = new Date(iso).toDateString();
                        document.getElementById('modal').style.display='block';
                        document.querySelectorAll('.type-btn').forEach(b=>b.classList.remove('active'));
                        if(ent) { 
                            document.getElementById('inp-ot').value = ent.ot || ''; 
                            document.getElementById('inp-late').value = ent.lt || ''; 
                        } else {
                            document.getElementById('inp-ot').value = ''; 
                            document.getElementById('inp-late').value = ''; 
                        }
                    };
                    grid.appendChild(el);
                }
            },
            move: (v) => { s.date.setMonth(s.date.getMonth()+v); cal.render(); }
        };

        const data = {
            set: (t, btn) => { sel.t = t; document.querySelectorAll('.type-btn').forEach(b=>b.classList.remove('active')); btn.classList.add('active'); },
            save: () => {
                const p = { t: sel.t || 'Present', ot: document.getElementById('inp-ot').value, lt: document.getElementById('inp-late').value };
                db.ref(`u/${s.uid}/att/${sel.d}`).set(p).then(() => { s.data[sel.d] = p; cal.render(); document.getElementById('modal').style.display='none'; });
            },
            clear: () => {
                if(!confirm("Are you sure you want to clear this entry?")) return;
                db.ref(`u/${s.uid}/att/${sel.d}`).remove().then(() => {
                    delete s.data[sel.d]; 
                    cal.render(); 
                    document.getElementById('modal').style.display='none';
                });
            }
        };

        const settings = {
            save: () => {
                s.conf.cur = document.getElementById('set-cur').value;
                s.conf.sal = parseFloat(document.getElementById('set-sal').value) || 0;
                s.conf.otr = parseFloat(document.getElementById('set-otr').value) || 0;
                db.ref(`u/${s.uid}/conf`).set(s.conf).then(()=>alert("Saved!"));
            }
        };

        const ui = {
            openProfile: () => {
                document.getElementById('settings').style.display = 'flex';
                document.getElementById('prof-id').innerText = s.uid;
                const days = Math.ceil((s.sub - Date.now()) / 86400000);
                document.getElementById('prof-status').innerText = days > 0 ? days + " DAYS LEFT" : "EXPIRED";
                document.getElementById('prof-exp').innerText = "Premium valid till: " + new Date(s.sub).toDateString();
            }
        };

        const reports = {
            open: () => { document.getElementById('reports').style.display='flex'; },
            calc: () => {
                const start = new Date(document.getElementById('r-start').value);
                const end = new Date(document.getElementById('r-end').value);
                if(!start || !end) return alert("Select Dates");
                let pres=0, otHrs=0, tot=0;
                for(let k in s.data) {
                    const d = new Date(k);
                    if(d >= start && d <= end) {
                        if(['Present','Holiday','Sick'].includes(s.data[k].t)) pres++;
                        otHrs += parseFloat(s.data[k].ot||0);
                        tot++;
                    }
                }
                const earn = (pres * s.conf.sal) + (otHrs * s.conf.otr);
                document.getElementById('r-out').innerHTML = `<div style="background:#222; padding:20px; border-radius:20px; border:1px solid var(--border);"><p>Entries: <b>${tot}</b></p><p>Paid Days: <b>${pres}</b></p><p>OT: <b>${otHrs} Hrs</b></p><hr><h3 style="color:var(--secondary)">Total: ${s.conf.cur} ${earn}</h3><button onclick="document.getElementById('reports').style.display='none'" class="action-btn">Close</button></div>`;
            }
        };

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault(); deferredPrompt = e;
            document.getElementById('pwa-install-btn').style.display = 'block';
        });
        const pwa = {
            install: () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then((choice) => {
                        if (choice.outcome === 'accepted') document.getElementById('pwa-install-btn').style.display = 'none';
                        deferredPrompt = null;
                    });
                }
            }
        };
        if('serviceWorker' in navigator) navigator.serviceWorker.register('./sw.js');
    </script>
</body>
</html>