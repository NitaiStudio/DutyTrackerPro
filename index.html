<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Duty Tracker Pro</title>
    
    <!-- PWA Requirements -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- Libraries -->
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

    <!-- WEBPUSHR TRACKING CODE (ADDED) --> 
    <script>
        (function(w,d, s, id) {
            if(typeof(w.webpushr)!=='undefined') return;
            w.webpushr=w.webpushr||function(){(w.webpushr.q=w.webpushr.q||[]).push(arguments)};
            var js, fjs = d.getElementsByTagName(s)[0];
            js = d.createElement(s); js.id = id;js.async=1;
            js.src = "https://cdn.webpushr.com/app.min.js";
            fjs.parentNode.appendChild(js);
        }(window,document, 'script', 'webpushr-jssdk'));
        
        webpushr('setup',{'key':'BNwA8Tr6AI0ev1OonW4CUNLBEfBlDZGSJXXzRojKBCjdtWM4KexFUnEfyR3dhF6pU2oTTB-p1vJYNZug24Ge_dc' });
    </script>
    <!-- END WEBPUSHR CODE -->

    <style>
        :root {
            /* DARK THEME (Default) */
            --bg: #000000;
            --surface: #101010;
            --card: #181818;
            --text: #ffffff;
            --text-sub: #a0a0a0;
            --primary: #4361ee;
            --secondary: #4cc9f0;
            --accent: #f72585;
            --border: rgba(255, 255, 255, 0.15);
            --input: #222222;
            --gradient: linear-gradient(135deg, #4361ee, #4cc9f0);
            --shadow: 0 8px 32px rgba(0,0,0,0.5);
        }

        [data-theme="light"] {
            /* LIGHT THEME */
            --bg: #f8f9fa;
            --surface: #ffffff;
            --card: #ffffff;
            --text: #212529;
            --text-sub: #6c757d;
            --primary: #3a0ca3;
            --secondary: #4895ef;
            --accent: #f72585;
            --border: rgba(0, 0, 0, 0.1);
            --input: #e9ecef;
            --gradient: linear-gradient(135deg, #3a0ca3, #4895ef);
            --shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        * { margin:0; padding:0; box-sizing:border-box; font-family:'Outfit', sans-serif; -webkit-tap-highlight-color:transparent; }
        body { background:var(--bg); color:var(--text); height:100vh; display:flex; flex-direction:column; overflow-x:hidden; transition:background 0.3s, color 0.3s; }

        /* --- ANIMATIONS --- */
        @keyframes fadeIn { from { opacity:0; transform:translateY(20px); } to { opacity:1; transform:translateY(0); } }
        @keyframes popIn { from { opacity:0; transform:scale(0.9); } to { opacity:1; transform:scale(1); } }
        @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-10px); } 100% { transform: translateY(0px); } }
        @keyframes spin { to { transform: rotate(360deg); } }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.02); } 100% { transform: scale(1); } }

        /* --- COMPONENTS --- */
        .btn { width:100%; padding:15px; border:none; border-radius:14px; font-weight:700; cursor:pointer; display:flex; justify-content:center; align-items:center; gap:10px; transition:0.2s; font-size:15px; letter-spacing:0.5px; }
        .btn-primary { background:var(--gradient); color:white; box-shadow:0 5px 20px rgba(67, 97, 238, 0.4); }
        .btn-primary:active { transform:scale(0.97); }
        
        .btn-sec { background:var(--input); color:var(--text); border:1px solid var(--border); transition: 0.2s; }
        .btn-sec.active { 
            background: rgba(67, 97, 238, 0.15); 
            border-color: var(--primary); 
            color: var(--primary); 
            box-shadow: 0 0 15px rgba(67, 97, 238, 0.3);
        }

        .btn-danger { background:rgba(247, 37, 133, 0.1); color:var(--accent); border:1px solid var(--accent); }

        .inp, select { width:100%; padding:16px; background:var(--input); border:1px solid var(--border); color:var(--text); border-radius:12px; outline:none; font-size:16px; margin-bottom:15px; transition:0.3s; }
        .inp:focus { border-color:var(--primary); background:var(--card); }

        /* Date Input Fix for Mobile */
        input[type="date"] {
            width: 100%;
            padding: 12px;
            font-family: 'Outfit', sans-serif;
            font-size: 14px;
            text-align: center;
            appearance: none;
            -webkit-appearance: none;
            background: var(--input);
            color: var(--text);
            border-radius: 12px;
            border: 1px solid var(--border);
        }

        /* --- TOAST --- */
        #toast { visibility: hidden; min-width: 250px; background-color: #222; color: #fff; text-align: center; border-radius: 50px; padding: 16px; position: fixed; z-index: 12000; left: 50%; bottom: 30px; transform: translateX(-50%); font-size: 14px; box-shadow: 0 5px 20px rgba(0,0,0,0.4); border: 1px solid var(--border); opacity: 0; transition: opacity 0.3s, bottom 0.3s; }
        #toast.show { visibility: visible; opacity: 1; bottom: 80px; }

        /* --- CONFIRM MODAL --- */
        #confirm-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 13000; display: none; align-items: center; justify-content: center; padding: 20px; backdrop-filter: blur(5px); }
        .confirm-box { background: var(--card); width: 100%; max-width: 320px; padding: 25px; border-radius: 20px; border: 1px solid var(--border); text-align: center; animation: popIn 0.3s; }
        .confirm-title { font-size: 18px; font-weight: 700; margin-bottom: 10px; color: var(--text); }
        .confirm-desc { font-size: 14px; color: var(--text-sub); margin-bottom: 25px; }
        .confirm-actions { display: flex; gap: 10px; }

        /* --- SPLASH --- */
        #splash { position:fixed; inset:0; background:linear-gradient(135deg, #020024, #090979, #00d4ff); z-index:9999; display:flex; flex-direction:column; align-items:center; justify-content:center; text-align:center; transition:opacity 0.8s; }
        .splash-logo { font-size:80px; color:white; margin-bottom:20px; animation:float 3s ease-in-out infinite; text-shadow:0 10px 30px rgba(0,0,0,0.5); }
        .loader { width:50px; height:50px; border:4px solid rgba(255,255,255,0.2); border-top-color:white; border-radius:50%; animation:spin 1s linear infinite; margin:30px 0; }
        .india-badge { display:flex; align-items:center; gap:8px; background:rgba(255,255,255,0.1); padding:8px 16px; border-radius:20px; backdrop-filter:blur(5px); margin-top:20px; animation:fadeIn 1s ease-out; }
        .india-flag { width:24px; height:16px; box-shadow:0 0 10px rgba(255,165,0,0.5); }

        /* --- AUTH --- */
        #auth-screen { position:fixed; inset:0; background:var(--bg); z-index:5000; display:none; align-items:center; justify-content:center; padding:20px; }
        .auth-card { background:var(--card); padding:35px; width:100%; max-width:400px; border-radius:24px; border:1px solid var(--border); text-align:center; box-shadow:var(--shadow); animation:fadeIn 0.4s ease-out; }

        /* --- MAIN APP --- */
        #main-app { display:none; flex-direction:column; flex:1; padding-bottom:100px; }
        nav { padding:15px 20px; background:rgba(var(--bg), 0.85); backdrop-filter:blur(15px); border-bottom:1px solid var(--border); position:sticky; top:0; z-index:100; display:flex; justify-content:space-between; align-items:center; }
        .logo { font-size:22px; font-weight:800; background:var(--gradient); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
        
        #pwa-install { background:var(--gradient); color:white; padding:6px 14px; border-radius:20px; font-size:11px; font-weight:bold; border:none; display:none; cursor:pointer; }

        /* CALENDAR */
        .cal-header { display:flex; justify-content:space-between; align-items:center; padding:20px; }
        .cal-grid { display:grid; grid-template-columns:repeat(7, 1fr); gap:8px; padding:0 12px; }
        .day { height:90px; background:var(--card); border-radius:14px; border:1px solid var(--border); display:flex; flex-direction:column; align-items:center; justify-content:center; position:relative; transition:0.2s; }
        .day:active { transform:scale(0.95); }
        .day.today { border:2px solid var(--secondary); background:rgba(76, 201, 240, 0.1); }
        .day-num { font-weight:700; font-size:18px; }
        .day-tag { font-size:10px; margin-top:4px; font-weight:600; text-align:center; }
        .ot-badge { font-size:9px; background:rgba(0,0,0,0.4); padding:2px 6px; border-radius:4px; margin-top:2px; color:white; }

        .bg-Present { background:#06d6a0 !important; color:black; }
        .bg-Leave { background:#ef233c !important; color:white; }
        .bg-Sick { background:#ff9f1c !important; color:black; }
        .bg-Holiday { background:#9d4edd !important; color:white; }
        .bg-HalfDay { background:#ffd166 !important; color:black; }
        .bg-Off { background:#6c757d !important; color:white; }

        /* BOTTOM NAV */
        .bottom-nav { position:fixed; bottom:20px; left:50%; transform:translateX(-50%); width:90%; max-width:400px; background:rgba(20,20,20,0.9); backdrop-filter:blur(20px); border:1px solid var(--border); border-radius:24px; padding:10px; display:flex; justify-content:space-around; align-items:center; z-index:900; box-shadow:0 10px 40px rgba(0,0,0,0.5); }
        [data-theme="light"] .bottom-nav { background:rgba(255,255,255,0.9); }
        .nav-btn { font-size:24px; color:var(--text-sub); background:none; border:none; padding:12px; border-radius:12px; transition:0.3s; }
        .nav-btn.active { color:white; background:var(--primary); transform:translateY(-5px); box-shadow:0 5px 15px rgba(67, 97, 238, 0.4); }

        /* PAGES */
        .page { position:fixed; inset:0; background:var(--bg); z-index:2000; display:none; flex-direction:column; overflow-y:auto; padding-bottom:150px; animation:fadeIn 0.3s ease-out; }
        .page-header { padding:20px; display:flex; align-items:center; gap:15px; background:var(--surface); border-bottom:1px solid var(--border); position:sticky; top:0; z-index:10; }

        /* PROFILE */
        .profile-header { text-align:center; padding:30px 20px; background:linear-gradient(180deg, rgba(67, 97, 238, 0.1), transparent); }
        .avatar { font-size:70px; color:var(--text); background:var(--card); padding:20px; border-radius:50%; border:2px solid var(--primary); margin-bottom:15px; }
        .ref-box { background:var(--card); border:1px dashed var(--primary); padding:20px; border-radius:20px; text-align:center; margin:0 20px; }
        
        .section-title { font-size:14px; font-weight:700; color:var(--text-sub); margin:25px 20px 10px; text-transform:uppercase; letter-spacing:1px; }
        .settings-card { background:var(--card); border-radius:20px; margin:0 20px; border:1px solid var(--border); padding:20px; }
        
        .action-item { display:flex; align-items:center; gap:15px; padding:15px; border-bottom:1px solid var(--border); cursor:pointer; }
        .action-item:last-child { border-bottom:none; }
        .action-item:active { background:var(--surface); }

        /* MODALS */
        .modal { position:fixed; bottom:0; left:0; width:100%; background:var(--surface); border-radius:30px 30px 0 0; padding:30px 25px; z-index:5000; border-top:1px solid var(--border); display:none; box-shadow:0 -10px 50px rgba(0,0,0,0.8); animation:fadeIn 0.3s; }
        
        .pay-overlay { position:fixed; inset:0; background:rgba(0,0,0,0.95); z-index:8000; display:none; align-items:center; justify-content:center; padding:20px; }

        #legal-modal { position:fixed; inset:0; background:var(--bg); z-index:9000; display:none; overflow-y:auto; padding:20px; }
        .legal-content { max-width:800px; margin:0 auto; color:var(--text-sub); line-height:1.8; text-align:justify; font-size:14px; }

    </style>
</head>
<body>

    <!-- TOAST -->
    <div id="toast">Message Here</div>

    <!-- CONFIRM MODAL -->
    <div id="confirm-modal">
        <div class="confirm-box">
            <div class="confirm-title" id="c-title">Are you sure?</div>
            <div class="confirm-desc" id="c-desc">This action cannot be undone.</div>
            <div class="confirm-actions">
                <button class="btn btn-sec" style="width:100%" onclick="ui.closeConfirm()">Cancel</button>
                <button class="btn btn-primary" style="width:100%" id="c-yes-btn">Yes</button>
            </div>
        </div>
    </div>

    <!-- SPLASH -->
    <div id="splash">
        <i class="fas fa-shield-alt splash-logo"></i>
        <h1 style="color:white; font-weight:300;">Duty Tracker <b style="font-weight:800;">Pro</b></h1>
        <div class="loader"></div>
        <div class="india-badge">
            <span style="color:#ccc; font-size:12px;">Made in India</span>
            <img src="https://flagcdn.com/w40/in.png" class="india-flag" alt="Indian Flag">
        </div>
        <div style="position:absolute; bottom:30px; color:#666; font-size:12px;">Developer By <b>Nitai Studio</b></div>
    </div>

    <!-- AUTH -->
    <div id="auth-screen">
        <div class="auth-card">
            <i class="fas fa-fingerprint" style="font-size:50px; color:var(--primary); margin-bottom:20px;"></i>
            <h2 style="margin-bottom:10px; color:var(--text);">Welcome</h2>
            <p style="color:var(--text-sub); font-size:13px; margin-bottom:25px;">Select your country to login</p>
            <div style="display:flex; gap:10px; margin-bottom:20px;">
                <select id="cc" class="inp" style="width:140px; margin:0; padding:12px;"></select>
                <input type="number" id="phone" class="inp" placeholder="Phone Number" style="margin:0;">
            </div>
            <button class="btn btn-primary" onclick="app.login()">Verify & Continue</button>
        </div>
    </div>

    <!-- MAIN APP -->
    <div id="main-app">
        <nav>
            <div class="logo">Duty Tracker Pro</div>
            <div style="display:flex; align-items:center; gap:15px;">
                <button id="pwa-install" onclick="pwa.install()">INSTALL APP</button>
                <i class="fas fa-adjust" style="font-size:22px; cursor:pointer;" onclick="ui.toggleTheme()"></i>
            </div>
        </nav>

        <div class="cal-header">
            <button onclick="cal.move(-1)" style="background:none; border:none; color:var(--text); font-size:24px;"><i class="fas fa-chevron-left"></i></button>
            <h2 id="month-display" style="font-weight:700;">...</h2>
            <button onclick="cal.move(1)" style="background:none; border:none; color:var(--text); font-size:24px;"><i class="fas fa-chevron-right"></i></button>
        </div>

        <div style="display:grid; grid-template-columns:repeat(7,1fr); text-align:center; font-weight:bold; font-size:12px; margin-bottom:10px; padding:0 12px; color:var(--text-sub);">
            <div>S</div><div>M</div><div>T</div><div>W</div><div>T</div><div>F</div><div>S</div>
        </div>
        <div id="calendar-grid" class="cal-grid"></div>

        <div class="bottom-nav">
            <button class="nav-btn" onclick="ui.openReport()"><i class="fas fa-chart-pie"></i></button>
            <button class="nav-btn active" onclick="ui.closeAll()"><i class="fas fa-home"></i></button>
            <button class="nav-btn" onclick="ui.openProfile()"><i class="fas fa-user-circle"></i></button>
        </div>
    </div>

    <!-- PROFILE -->
    <div id="page-profile" class="page">
        <div class="page-header">
            <i class="fas fa-arrow-left" style="font-size:24px; cursor:pointer;" onclick="ui.closeAll()"></i>
            <h2>My Profile</h2>
        </div>
        
        <div class="profile-header">
            <i class="fas fa-user-astronaut avatar"></i>
            <h2 id="prof-id" style="margin-bottom:5px;">...</h2>
            <div style="background:var(--accent); color:white; padding:4px 12px; border-radius:20px; font-size:11px; font-weight:bold; display:inline-block;" id="prof-badge">PREMIUM</div>
            
            <!-- FIXED DATE & DAYS LEFT -->
            <p id="prof-exp" style="color:var(--text-sub); font-size:13px; margin-top:8px; line-height:1.5;">Checking...</p>
        </div>

        <div class="ref-box">
            <h3 style="color:var(--primary); margin-bottom:10px;">üéÅ Refer & Earn</h3>
            <p style="font-size:12px; color:var(--text-sub);">You get +30 Days, Friend gets +10 Days.</p>
            <div id="my-ref-code" style="font-size:32px; font-weight:900; color:var(--secondary); margin:15px 0; letter-spacing:3px;">LOADING</div>
            <button class="btn btn-sec" onclick="ref.share()"><i class="fas fa-share-alt"></i> Share Code</button>
            <div style="display:flex; gap:10px; margin-top:20px; border-top:1px solid var(--border); padding-top:20px;">
                <input type="text" id="friend-code" class="inp" placeholder="ENTER CODE" style="margin:0; text-transform:uppercase;">
                <button class="btn btn-primary" style="width:auto;" onclick="ref.redeem()">Apply</button>
            </div>
        </div>

        <!-- NEW: NOTIFICATIONS SECTION (ADDED) -->
        <div class="section-title">Notifications</div>
        <div class="settings-card" style="padding:0;">
            <div class="action-item" onclick="if(window.webpushr) window.webpushr('subscribe');">
                <i class="fas fa-bell" style="color:var(--accent); font-size:20px;"></i>
                <div style="flex:1;">
                    <div style="font-weight:600;">Enable Alerts</div>
                    <div style="font-size:12px; color:var(--text-sub);">Get updates & reminders</div>
                </div>
                <div style="background:var(--surface); padding:5px 10px; border-radius:10px; font-size:10px; font-weight:bold;">SETUP</div>
            </div>
        </div>

        <div class="section-title">Settings</div>
        <div class="settings-card">
            <label style="font-size:12px; color:var(--text-sub);">Currency</label>
            <select id="set-cur" class="inp" style="margin-bottom:10px;"><option value="‚Çπ">‚Çπ INR</option><option value="‡ß≥">‡ß≥ BDT</option><option value="$">$ USD</option><option value="‚Ç¨">‚Ç¨ EUR</option><option value="SAR">SAR</option><option value="AED">AED</option></select>
            
            <label style="font-size:12px; color:var(--text-sub);">Basic Salary</label>
            <input type="number" id="set-sal" class="inp" placeholder="0" style="margin-bottom:10px;">
            
            <label style="font-size:12px; color:var(--text-sub);">Food Allowance</label>
            <input type="number" id="set-food" class="inp" placeholder="0" style="margin-bottom:10px;">
            
            <label style="font-size:12px; color:var(--text-sub);">OT Rate (Per Hour)</label>
            <input type="number" id="set-otr" class="inp" placeholder="0" style="margin-bottom:10px;">

            <label style="font-size:12px; color:var(--text-sub);">Provident Fund (PF)</label>
            <input type="number" id="set-pf" class="inp" placeholder="0" style="margin-bottom:15px;">
            
            <button class="btn btn-primary" onclick="settings.save()">Save Configuration</button>
        </div>

        <div class="section-title">Support & Info</div>
        <div class="settings-card" style="padding:0;">
            <div class="action-item" onclick="location.href='mailto:nitai.grp00@gmail.com'">
                <i class="fas fa-envelope" style="color:var(--primary); font-size:20px;"></i>
                <div style="flex:1;"><div style="font-weight:600;">Contact Support</div><div style="font-size:12px; color:var(--text-sub);">nitai.grp00@gmail.com</div></div>
                <i class="fas fa-chevron-right" style="color:var(--text-sub);"></i>
            </div>
            
            <div class="action-item" onclick="window.open('https://buymeacoffee.com/nitaigrp00a','_blank')">
                <i class="fas fa-coffee" style="color:#FFDD00; font-size:20px;"></i>
                <div style="flex:1;"><div style="font-weight:600;">Buy Me A Coffee</div><div style="font-size:12px; color:var(--text-sub);">Donate & Support</div></div>
                <i class="fas fa-external-link-alt" style="color:var(--text-sub);"></i>
            </div>

            <div class="action-item" onclick="window.open('https://dutytracker-admin.vercel.app/','_blank')">
                <i class="fas fa-rocket" style="color:var(--secondary); font-size:20px;"></i>
                <div style="flex:1;"><div style="font-weight:600;">Check for Updates</div><div style="font-size:12px; color:var(--text-sub);">Download latest version</div></div>
                <i class="fas fa-download" style="color:var(--text-sub);"></i>
            </div>

            <div class="action-item" onclick="legal.show('privacy')">
                <i class="fas fa-shield-alt" style="color:var(--text-sub);"></i> <span style="flex:1;">Privacy Policy</span>
            </div>
            <div class="action-item" onclick="legal.show('refund')">
                <i class="fas fa-undo" style="color:var(--text-sub);"></i> <span style="flex:1;">Refund Policy</span>
            </div>
            <div class="action-item" onclick="legal.show('terms')">
                <i class="fas fa-file-contract" style="color:var(--text-sub);"></i> <span style="flex:1;">Terms & Conditions</span>
            </div>
        </div>

        <button class="btn btn-danger" style="margin: 30px auto 50px; width: 40%; padding: 10px; font-size: 13px; display: block;" onclick="app.logout()">Log Out</button>
    </div>

    <!-- REPORTS -->
    <div id="page-reports" class="page">
        <div class="page-header">
            <i class="fas fa-arrow-left" style="font-size:24px; cursor:pointer;" onclick="ui.closeAll()"></i>
            <h2>Reports</h2>
        </div>
        <div style="padding:20px;">
            <div class="settings-card">
                <!-- FIXED DATE INPUTS UI -->
                <div style="display:flex; flex-direction:column; gap:10px; margin-bottom:15px;">
                    <div>
                        <label style="font-size:12px; color:var(--text-sub);">From Date</label>
                        <input type="date" id="r-start" class="inp" style="margin:0;">
                    </div>
                    <div>
                        <label style="font-size:12px; color:var(--text-sub);">To Date</label>
                        <input type="date" id="r-end" class="inp" style="margin:0;">
                    </div>
                </div>
                <button class="btn btn-primary" onclick="reports.gen()">Generate Report</button>
            </div>
            <div id="report-out"></div>
        </div>
    </div>

    <!-- ATTENDANCE MODAL -->
    <div id="att-modal" class="modal">
        <h3 id="modal-date" style="text-align:center; margin-bottom:20px;">...</h3>
        <div style="display:grid; grid-template-columns:repeat(3,1fr); gap:10px; margin-bottom:20px;">
            <button class="btn btn-sec" onclick="data.set('Present', this)">Present</button>
            <button class="btn btn-sec" onclick="data.set('Half Day', this)">Half Day</button>
            <button class="btn btn-sec" onclick="data.set('Leave', this)">Leave</button>
            <button class="btn btn-sec" onclick="data.set('Sick', this)">Sick</button>
            <button class="btn btn-sec" onclick="data.set('Holiday', this)">Holiday</button>
            <button class="btn btn-sec" onclick="data.set('Off', this)">Off</button>
        </div>
        <div style="display:flex; gap:10px; margin-bottom:20px;">
            <input type="number" id="inp-ot" class="inp" placeholder="OT (Hrs)" style="margin:0;">
            <input type="number" id="inp-late" class="inp" placeholder="Late (Min)" style="margin:0;">
        </div>
        <button class="btn btn-primary" onclick="data.save()">SAVE ENTRY</button>
        <div style="display:flex; gap:10px; margin-top:15px;">
            <button class="btn btn-danger" onclick="data.clear()">DELETE</button>
            <button class="btn btn-sec" onclick="document.getElementById('att-modal').style.display='none'">CANCEL</button>
        </div>
    </div>

    <!-- PAYWALL -->
    <div id="pay-wall" class="pay-overlay">
        <div class="auth-card">
            <button id="pay-close-btn" onclick="document.getElementById('pay-wall').style.display='none'" style="position:absolute; top:20px; right:20px; background:none; border:none; color:var(--text); font-size:24px;">&times;</button>
            <i class="fas fa-crown" style="font-size:50px; color:var(--accent); margin-bottom:20px;"></i>
            <h2>Premium Expired</h2>
            <p style="color:var(--text-sub); font-size:13px; margin-bottom:20px;">Renew subscription to continue usage.</p>
            
            <div style="background:rgba(255,255,255,0.05); padding:15px; border-radius:12px; margin-bottom:10px; display:flex; justify-content:space-between; align-items:center;">
                <b>1 Month</b> <button class="btn btn-primary" style="width:auto; padding:8px 20px;" onclick="pay.buy(5, 30)">‚Çπ5</button>
            </div>
            <div style="background:rgba(255,255,255,0.05); padding:15px; border-radius:12px; margin-bottom:10px; display:flex; justify-content:space-between; align-items:center;">
                <b>1 Year</b> <button class="btn btn-primary" style="width:auto; padding:8px 20px;" onclick="pay.buy(40, 365)">‚Çπ40</button>
            </div>
        </div>
    </div>

    <!-- LEGAL MODAL -->
    <div id="legal-modal">
        <div style="max-width:800px; margin:0 auto;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <h2 id="legal-title" style="color:var(--primary);">Policy</h2>
                <button onclick="document.getElementById('legal-modal').style.display='none'" style="background:none; border:none; color:var(--text); font-size:26px;"><i class="fas fa-times"></i></button>
            </div>
            <div id="legal-body" class="legal-content"></div>
        </div>
    </div>

    <script>
        // CONFIG
        const firebaseConfig = { apiKey: "AIzaSyDxqq2PBqrtkTsygyMcIDOvZyx2_-x4QRk", authDomain: "duty-tracker-pro.firebaseapp.com", databaseURL: "https://duty-tracker-pro-default-rtdb.firebaseio.com", projectId: "duty-tracker-pro", storageBucket: "duty-tracker-pro.firebasestorage.app", messagingSenderId: "716525293622", appId: "1:716525293622:web:880f39084c86180fbb0897" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const RZP_KEY = "rzp_live_Rz7kQ4RAloCWGp";

        let s = { uid: null, data: {}, sub: 0, conf: {cur:'‚Çπ', sal:0, otr:0, food:0, pf:0}, refCode: '' };
        let curDate = new Date();
        let selDate = null;
        let selType = null;
        let deferredPrompt;

        // COUNTRIES
        const countries = [
            {n:"India",c:"+91"},{n:"Bangladesh",c:"+880"},{n:"USA",c:"+1"},{n:"UK",c:"+44"},{n:"UAE",c:"+971"},{n:"Saudi Arabia",c:"+966"},
            {n:"Kuwait",c:"+965"},{n:"Qatar",c:"+974"},{n:"Oman",c:"+968"},{n:"Bahrain",c:"+973"},{n:"Malaysia",c:"+60"},{n:"Singapore",c:"+65"},
            {n:"Pakistan",c:"+92"},{n:"Nepal",c:"+977"},{n:"Sri Lanka",c:"+94"},{n:"Maldives",c:"+960"},{n:"Afghanistan",c:"+93"},{n:"Canada",c:"+1"},
            {n:"Australia",c:"+61"},{n:"Germany",c:"+49"},{n:"France",c:"+33"},{n:"Italy",c:"+39"},{n:"Spain",c:"+34"},{n:"South Africa",c:"+27"},
            {n:"Other",c:""} 
        ];
        const ccSelect = document.getElementById('cc');
        countries.forEach(c => {
            let o = document.createElement('option'); o.value = c.c; o.innerText = `${c.n} (${c.c})`;
            ccSelect.appendChild(o);
        });

        // INIT
        document.addEventListener('DOMContentLoaded', () => {
            document.body.setAttribute('data-theme', localStorage.getItem('theme') || 'dark');
            setTimeout(() => {
                document.getElementById('splash').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('splash').style.display='none';
                    const id = localStorage.getItem('dt_id');
                    if(id) app.start(id);
                    else document.getElementById('auth-screen').style.display='flex';
                }, 800);
            }, 3000);
        });

        const app = {
            login: () => {
                const id = document.getElementById('cc').value + document.getElementById('phone').value;
                if(document.getElementById('phone').value.length > 5) {
                    localStorage.setItem('dt_id', id);
                    document.getElementById('auth-screen').style.display='none';
                    app.start(id);
                } else ui.toast("Invalid Number");
            },
            logout: () => {
                ui.confirm("Log Out", "Are you sure you want to log out?", () => {
                    localStorage.removeItem('dt_id'); location.reload();
                });
            },
            start: (id) => {
                s.uid = id;
                document.getElementById('main-app').style.display = 'flex';
                db.ref('u/'+id).on('value', sn => {
                    const v = sn.val() || {};
                    s.data = v.att || {};
                    s.conf = v.conf || {cur:'‚Çπ', sal:0, otr:0, food:0, pf:0};
                    s.sub = v.subExp || Date.now() + (3*86400000); 
                    if(!v.subExp) db.ref('u/'+id+'/subExp').set(s.sub);

                    if(!v.refCode) ref.gen();
                    else {
                        s.refCode = v.refCode;
                        document.getElementById('my-ref-code').innerText = s.refCode;
                    }

                    // PROFILE DATE & DAYS LEFT (FIXED)
                    const expD = new Date(s.sub);
                    const now = Date.now();
                    const diff = Math.ceil((s.sub - now) / (1000 * 60 * 60 * 24));
                    const isExp = diff <= 0;
                    
                    document.getElementById('prof-exp').innerHTML = 
                        `Valid till: ${expD.toLocaleDateString()}<br>` +
                        `<span style="color:${isExp ? '#FF1744' : '#00E5FF'}; font-weight:bold;">` +
                        `${isExp ? 'Expired' : diff + ' Days Left'}</span>`;

                    if(isExp) {
                        document.getElementById('pay-wall').style.display = 'flex';
                        document.getElementById('pay-close-btn').style.display = 'none'; 
                        const badge = document.getElementById('prof-badge');
                        if(badge) { badge.innerText="EXPIRED"; badge.style.backgroundColor="#FF1744"; badge.style.color="white"; }
                    } else {
                        document.getElementById('pay-wall').style.display = 'none';
                        const badge = document.getElementById('prof-badge');
                        if(badge) { badge.innerText="PREMIUM"; badge.style.backgroundColor="#00C853"; badge.style.color="black"; }
                    }

                    document.getElementById('set-cur').value = s.conf.cur || '‚Çπ';
                    document.getElementById('set-sal').value = s.conf.sal || '';
                    document.getElementById('set-food').value = s.conf.food || '';
                    document.getElementById('set-otr').value = s.conf.otr || '';
                    document.getElementById('set-pf').value = s.conf.pf || '';

                    cal.render();
                });
            }
        };

        const cal = {
            render: () => {
                const y=curDate.getFullYear(), m=curDate.getMonth();
                document.getElementById('month-display').innerText = new Date(y,m).toLocaleString('default',{month:'long',year:'numeric'});
                const g = document.getElementById('calendar-grid'); g.innerHTML='';
                const fd = new Date(y,m,1).getDay(), ld = new Date(y,m+1,0).getDate();
                const today = new Date().toISOString().split('T')[0];

                for(let i=0; i<fd; i++) g.innerHTML += '<div></div>';
                for(let i=1; i<=ld; i++) {
                    const iso = `${y}-${String(m+1).padStart(2,'0')}-${String(i).padStart(2,'0')}`;
                    const d = s.data[iso];
                    const cls = d ? 'bg-'+d.t.replace(' ','') : '';
                    const el = document.createElement('div');
                    el.className = `day ${cls} ${iso===today?'today':''}`;
                    el.innerHTML = `<span class="day-num">${i}</span>`;
                    if(d) {
                        el.innerHTML += `<span class="day-tag">${d.t}</span>`;
                        if(d.ot) el.innerHTML += `<div class="ot-badge">OT: ${d.ot}</div>`;
                    }
                    el.onclick = () => data.open(iso);
                    g.appendChild(el);
                }
            },
            move: (n) => { curDate.setMonth(curDate.getMonth()+n); cal.render(); }
        };

        const data = {
            open: (d) => {
                selDate = d;
                document.getElementById('modal-date').innerText = new Date(d).toDateString();
                document.getElementById('att-modal').style.display='block';
                document.querySelectorAll('.btn-sec').forEach(b => b.classList.remove('active'));
                const en = s.data[d];
                if(en) {
                    document.getElementById('inp-ot').value = en.ot||'';
                    document.getElementById('inp-late').value = en.lt||'';
                } else {
                    document.getElementById('inp-ot').value = '';
                    document.getElementById('inp-late').value = '';
                    selType = null;
                }
            },
            set: (t, el) => {
                selType = t;
                document.querySelectorAll('.btn-sec').forEach(b => b.classList.remove('active'));
                if(el) el.classList.add('active');
            },
            save: () => {
                if(!selType && s.data[selDate]) selType = s.data[selDate].t;
                if(!selType) selType = 'Present';
                const p = { t: selType, ot: document.getElementById('inp-ot').value, lt: document.getElementById('inp-late').value };
                db.ref(`u/${s.uid}/att/${selDate}`).set(p);
                document.getElementById('att-modal').style.display='none';
                ui.toast("Saved Successfully");
            },
            clear: () => {
                ui.confirm("Delete Entry", "Are you sure you want to delete this duty record?", () => {
                    db.ref(`u/${s.uid}/att/${selDate}`).remove();
                    document.getElementById('att-modal').style.display='none';
                    ui.toast("Entry Deleted");
                });
            }
        };

        const ui = {
            toggleTheme: () => {
                const b = document.body;
                const n = b.getAttribute('data-theme')==='light'?'dark':'light';
                b.setAttribute('data-theme', n); localStorage.setItem('theme', n);
            },
            closeAll: () => {
                document.querySelectorAll('.page').forEach(p=>p.style.display='none');
                document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
                document.querySelectorAll('.nav-btn')[1].classList.add('active');
            },
            openProfile: () => {
                document.getElementById('page-profile').style.display='flex';
                document.getElementById('prof-id').innerText = s.uid;
                if(s.refCode) document.getElementById('my-ref-code').innerText = s.refCode;
                document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
                document.querySelectorAll('.nav-btn')[2].classList.add('active');
            },
            openReport: () => {
                document.getElementById('page-reports').style.display='flex';
                document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
                document.querySelectorAll('.nav-btn')[0].classList.add('active');
            },
            toast: (msg) => {
                const x = document.getElementById("toast");
                x.innerText = msg;
                x.className = "show";
                setTimeout(function(){ x.className = x.className.replace("show", ""); }, 3000);
            },
            confirm: (title, desc, callback) => {
                document.getElementById('c-title').innerText = title;
                document.getElementById('c-desc').innerText = desc;
                const modal = document.getElementById('confirm-modal');
                modal.style.display = "flex";
                
                const yesBtn = document.getElementById('c-yes-btn');
                const newBtn = yesBtn.cloneNode(true);
                yesBtn.parentNode.replaceChild(newBtn, yesBtn);
                
                newBtn.onclick = () => {
                    callback();
                    modal.style.display = "none";
                };
            },
            closeConfirm: () => {
                document.getElementById('confirm-modal').style.display = "none";
            }
        };

        const ref = {
            gen: () => {
                const c = Math.random().toString(36).substring(2,8).toUpperCase();
                db.ref('refList/'+c).set(s.uid);
                db.ref(`u/${s.uid}/refCode`).set(c);
            },
            share: () => {
                const t = `Use code ${s.refCode} on Duty Tracker Pro. Get +10 Days Free! Download: https://dutytrackerpro.blogspot.com`;
                if(navigator.share) navigator.share({title:'Referral', text:t}); else prompt("Copy", s.refCode);
            },
            redeem: () => {
                const c = document.getElementById('friend-code').value.toUpperCase().trim();
                if(c===s.refCode) return ui.toast("Own code not allowed");
                db.ref(`u/${s.uid}/redeemed`).once('value', sn => {
                    if(sn.exists()) return ui.toast("Already Redeemed");
                    db.ref('refList/'+c).once('value', rsn => {
                        if(!rsn.val()) return ui.toast("Invalid Code");
                        const rid = rsn.val();
                        db.ref(`u/${s.uid}/subExp`).set(Math.max(s.sub, Date.now()) + (10*86400000));
                        db.ref(`u/${s.uid}/redeemed`).set(true);
                        db.ref(`u/${rid}/subExp`).once('value', os => {
                            db.ref(`u/${rid}/subExp`).set(Math.max(os.val()||Date.now(), Date.now()) + (30*86400000));
                        });
                        ui.toast("Success! +10 Days Added");
                    });
                });
            }
        };

        const settings = {
            save: () => {
                const c = {
                    cur: document.getElementById('set-cur').value,
                    sal: parseFloat(document.getElementById('set-sal').value)||0,
                    otr: parseFloat(document.getElementById('set-otr').value)||0,
                    food: parseFloat(document.getElementById('set-food').value)||0,
                    pf: parseFloat(document.getElementById('set-pf').value)||0
                };
                db.ref(`u/${s.uid}/conf`).set(c).then(()=>ui.toast("Configuration Saved"));
            }
        };

        const reports = {
            gen: () => {
                const d1 = new Date(document.getElementById('r-start').value);
                const d2 = new Date(document.getElementById('r-end').value);
                if(isNaN(d1)) return ui.toast("Select Dates");
                let dy=0, bs=0, ot=0, fd=0, totalOtHours=0;
                const SAL = parseFloat(s.conf.sal)||0, OTR = parseFloat(s.conf.otr)||0, FOOD = parseFloat(s.conf.food)||0, PF = parseFloat(s.conf.pf)||0;

                for(let k in s.data) {
                    const dt = new Date(k);
                    if(dt >= d1 && dt <= d2) {
                        const v = s.data[k];
                        const o = parseFloat(v.ot||0);
                        if(v.t==='Half Day') { dy+=0.5; bs+=(SAL/2); fd+=(FOOD/2); }
                        else if(['Present','Holiday','Sick'].includes(v.t)) { dy++; bs+=SAL; fd+=FOOD; }
                        ot += (o * OTR);
                        totalOtHours += o;
                    }
                }
                const gross = bs + ot + fd;
                const net = gross - PF;
                
                document.getElementById('report-out').innerHTML = `
                    <div style="background:var(--card); padding:20px; border-radius:20px; margin-top:20px; border:1px solid var(--border);">
                        <p style="display:flex; justify-content:space-between; margin-bottom:10px;"><span>Duty Days</span> <b>${dy}</b></p>
                        <p style="display:flex; justify-content:space-between; margin-bottom:10px;"><span>Basic</span> <b>${s.conf.cur}${bs.toFixed(0)}</b></p>
                        <p style="display:flex; justify-content:space-between; margin-bottom:10px;"><span>Food</span> <b>${s.conf.cur}${fd.toFixed(0)}</b></p>
                        <p style="display:flex; justify-content:space-between; margin-bottom:10px;"><span>OT Amount</span> <b>${s.conf.cur}${ot.toFixed(0)}</b></p>
                        <p style="display:flex; justify-content:space-between; margin-bottom:10px;"><span>PF (Deduction)</span> <b>- ${s.conf.cur}${PF.toFixed(0)}</b></p>
                        <p style="display:flex; justify-content:space-between; margin-bottom:10px; color:#aaa; font-size:13px;"><span>Total OT Hours</span> <b>${totalOtHours} Hrs</b></p>
                        <hr style="border-color:var(--border); margin:15px 0;">
                        <h2 style="color:var(--secondary); text-align:right;">Net Pay: ${s.conf.cur}${net.toFixed(0)}</h2>
                        
                        <div onclick="pay.show(true)" style="background:linear-gradient(45deg,#FFD600,#FF6D00); color:black; padding:12px; border-radius:12px; text-align:center; margin-top:20px; font-weight:bold; cursor:pointer; animation:pulse 2s infinite;">
                            Premium Only ‚Çπ5/Month
                        </div>

                        <button class="btn btn-primary" style="margin-top:20px;" onclick="reports.pdf('${d1.toDateString()}','${d2.toDateString()}',${dy},${bs},${ot},${fd},${PF},${net})">
                            <i class="fas fa-file-pdf"></i> Download PDF
                        </button>
                    </div>`;
            },
            pdf: (d1,d2,dy,bs,ot,fd,pf,net) => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                doc.setFontSize(22); doc.setTextColor(41, 121, 255);
                doc.text("Duty Tracker Pro", 105, 20, null, null, "center");
                doc.setFontSize(12); doc.setTextColor(0);
                doc.text(`Salary Slip`, 105, 30, null, null, "center");
                doc.setFontSize(10);
                doc.text(`(${d1} - ${d2})`, 105, 36, null, null, "center");
                
                doc.setFontSize(12);
                doc.text(`User ID: ${s.uid}`, 14, 45);

                doc.autoTable({
                    startY: 55,
                    head: [['Description', 'Amount']],
                    body: [
                        [`Duty Days (${dy})`, `${s.conf.cur} ${bs}`],
                        ['Food Allowance', `${s.conf.cur} ${fd}`],
                        ['Overtime Pay', `${s.conf.cur} ${ot}`],
                        ['PF Deduction', `- ${s.conf.cur} ${pf}`],
                        [{content:'NET SALARY', styles:{fillColor:[41,121,255], textColor:255, fontStyle:'bold'}}, `${s.conf.cur} ${net}`]
                    ],
                    theme: 'grid',
                    headStyles: { fillColor: [41, 121, 255] }
                });

                const pageHeight = doc.internal.pageSize.height;
                const btnX = 60, btnY = pageHeight - 30, btnW = 90, btnH = 12;
                doc.setFillColor(41, 121, 255); 
                doc.roundedRect(btnX, btnY, btnW, btnH, 3, 3, 'F');
                doc.setTextColor(255, 255, 255); 
                doc.setFontSize(10); 
                doc.setFont(undefined, 'bold');
                doc.text("DOWNLOAD APP", 105, btnY + 8, { align: "center" });
                doc.link(btnX, btnY, btnW, btnH, { url: "https://dutytrackerpro.blogspot.com/?m=1" });

                doc.save('Salary_Slip.pdf');
            }
        };

        const pay = {
            buy: (amt, days) => {
                const options = {
                    "key": RZP_KEY,
                    "amount": amt * 100,
                    "currency": "INR",
                    "name": "Duty Tracker Pro",
                    "description": "Premium Subscription",
                    "handler": function (response){
                        db.ref(`u/${s.uid}/subExp`).set(Date.now() + (days * 86400000));
                        window.ui.toast("Subscription Activated!");
                        setTimeout(() => location.reload(), 1500);
                    },
                    "theme": { "color": "#4361ee" }
                };
                const rzp1 = new Razorpay(options);
                rzp1.open();
            },
            show: (canClose) => {
                document.getElementById('pay-wall').style.display='flex';
                document.getElementById('pay-close-btn').style.display = canClose ? 'block' : 'none';
            }
        };

        const legal = {
            show: (t) => {
                const longPrivacy = `<h3>Privacy Policy (Google Play Compliant)</h3><br><br><strong>1. Data Collection & Usage:</strong><br>We collect your mobile number exclusively for account authentication via Google Firebase. We do not access your contacts, camera, or location. Your duty records and salary configurations are stored securely on Firebase Realtime Database to enable cross-device synchronization.<br><br><strong>2. Data Sharing:</strong><br>We do not sell, trade, or rent your personal identification information to others. Your data is used strictly for the app's functionality.<br><br><strong>3. Data Retention & Deletion:</strong><br>Your data is retained as long as your account is active. You may request full account deletion by contacting support at nitai.grp00@gmail.com. We will process the deletion within 30 days.<br><br><strong>4. Security:</strong><br>We use industry-standard encryption to protect your data both in transit and at rest.`;
                const longRefund = `<h3>Refund Policy</h3><br><strong>1. Digital Goods:</strong><br>Duty Tracker Pro Premium subscription is a digital product. Once activated, it is considered consumed.<br><br><strong>2. Google Play Refunds:</strong><br>For subscriptions purchased via Google Play, you can request a refund directly through the Play Store within 48 hours if the purchase was accidental or defective.<br><br><strong>3. Developer Refunds:</strong><br>If you encounter technical issues preventing access to premium features after 48 hours, please contact support with your Order ID. We review these on a case-by-case basis.`;
                const longTerms = `<h3>Terms & Conditions</h3><br><strong>1. Acceptance:</strong><br>By downloading and using Duty Tracker Pro, you agree to these terms.<br><br><strong>2. Usage License:</strong><br>We grant you a personal, non-exclusive license to use the app for tracking personal work hours and salary estimation.<br><br><strong>3. Disclaimer:</strong><br>This app is a utility tool. The calculations are estimates based on your input. The developer is not responsible for financial discrepancies between the app's calculation and your employer's payroll.<br><br><strong>4. Subscription:</strong><br>Subscriptions automatically renew unless canceled 24 hours before the end of the current period via Google Play Settings.`;

                const map = {'privacy':longPrivacy, 'refund':longRefund, 'terms':longTerms};
                document.getElementById('legal-body').innerHTML = map[t];
                document.getElementById('legal-modal').style.display='block';
            }
        };

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault(); deferredPrompt = e;
            document.getElementById('pwa-install').style.display = 'block';
        });
        const pwa = {
            install: () => {
                if(deferredPrompt) {
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then((c) => {
                        if(c.outcome==='accepted') document.getElementById('pwa-install').style.display='none';
                        deferredPrompt = null;
                    });
                }
            }
        };
    </script>
</body>
</html>
