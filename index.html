<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#4A148C">
    <title>Duty Tracker Pro</title>

    <!-- PWA Support -->
    <link rel="manifest" href="manifest.json">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <!-- Razorpay SDK -->
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>

    <style>
        :root {
            --primary: #6200EA;
            --primary-dark: #4A148C;
            --bg: #F3F0F7;
            --surface: #FFFFFF;
            --text: #2D2D2D;
            --border: #EEEEEE;
            --card-sub: #F7F2FA;
            --grad: linear-gradient(135deg, #6200EA, #9575CD);
            --c-present: #43A047; --c-leave: #E53935; --c-sick: #FB8C00; --c-holiday: #E53935; --c-off: #546E7A;
        }

        [data-theme='dark'] {
            --bg: #121212; --surface: #1E1E1E; --text: #E0E0E0; --border: #333333; --card-sub: #2D2438;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Poppins', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: var(--text); height: 100vh; display: flex; flex-direction: column; overflow: hidden; transition: 0.3s; }

        /* SPLASH SCREEN */
        #splash { 
            position: fixed; inset: 0; background: var(--grad); z-index: 10000; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            color: white; transition: 0.8s cubic-bezier(0.9, 0, 0.1, 1); 
        }
        .splash-logo { width: 100px; height: 100px; background: rgba(255,255,255,0.2); border-radius: 30px; display: flex; align-items: center; justify-content: center; animation: bounce 2s infinite; margin-bottom: 20px; }
        .splash-footer { position: absolute; bottom: 40px; text-align: center; }
        .made-in { font-size: 12px; display: flex; align-items: center; justify-content: center; gap: 6px; opacity: 0.9; margin-top: 5px; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }

        /* APP HEADER */
        header { background: var(--grad); color: white; padding: 20px; border-radius: 0 0 35px 35px; box-shadow: 0 10px 20px rgba(0,0,0,0.1); z-index: 10; flex-shrink: 0; }
        .header-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .sub-status { font-size: 10px; background: rgba(255,255,255,0.2); padding: 5px 12px; border-radius: 20px; font-weight: 600; }
        .month-bar { display: flex; justify-content: space-between; align-items: center; background: rgba(255,255,255,0.15); padding: 8px; border-radius: 18px; }
        .nav-btn { background: white; border: none; width: 35px; height: 35px; border-radius: 12px; color: var(--primary); display: flex; align-items: center; justify-content: center; }

        /* CALENDAR */
        .week-days { display: grid; grid-template-columns: repeat(7, 1fr); text-align: center; font-size: 11px; font-weight: 700; margin-top: 15px; opacity: 0.8; }
        #calendar-grid { flex: 1; overflow-y: auto; padding: 15px; display: grid; grid-template-columns: repeat(7, 1fr); grid-auto-rows: minmax(95px, auto); gap: 10px; }
        .day-cell { background: var(--surface); border-radius: 20px; padding: 8px; display: flex; flex-direction: column; box-shadow: 0 4px 12px rgba(0,0,0,0.05); border: 2px solid transparent; min-height: 90px; }
        .day-cell.today { border-color: var(--primary); }
        .day-num { font-size: 14px; font-weight: 700; color: var(--text); }
        .day-sunday .day-num { color: #E53935; }

        /* STATUSES */
        .bg-Present { background: linear-gradient(to bottom right, #66BB6A, #43A047) !important; color: white !important; }
        .bg-Leave { background: linear-gradient(to bottom right, #EF5350, #E53935) !important; color: white !important; }
        .bg-Sick { background: linear-gradient(to bottom right, #FFA726, #FB8C00) !important; color: white !important; }
        .bg-Holiday { background: linear-gradient(to bottom right, #FF5252, #D32F2F) !important; color: white !important; }
        .bg-Off { background: #ECEFF1 !important; color: #546E7A !important; }
        .badge-ot { font-size: 9px; background: rgba(0,0,0,0.15); padding: 1px 5px; border-radius: 5px; margin-top: auto; font-weight: 600; text-align: center; }

        /* PAGE SYSTEM */
        .full-page { position: fixed; inset: 0; background: var(--bg); z-index: 500; transform: translateX(100%); transition: 0.4s ease; display: flex; flex-direction: column; }
        .full-page.open { transform: translateX(0); }
        .page-header { background: var(--surface); padding: 18px; display: flex; align-items: center; gap: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .section-card { background: var(--surface); margin: 12px; padding: 18px; border-radius: 25px; box-shadow: 0 5px 15px rgba(0,0,0,0.03); }

        /* UI ELEMENTS */
        .m-input { width: 100%; padding: 14px; border-radius: 15px; border: 1.5px solid var(--border); background: var(--bg); color: var(--text); font-size: 14px; outline: none; margin-top: 5px; }
        .btn-premium { background: var(--grad); color: white; border: none; width: 100%; padding: 15px; border-radius: 18px; font-weight: 700; font-size: 15px; box-shadow: 0 8px 15px rgba(98, 0, 234, 0.3); cursor: pointer; }

        /* MODAL */
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 1000; display: none; align-items: flex-end; justify-content: center; }
        .modal.show { display: flex; }
        .sheet { background: var(--surface); width: 100%; max-width: 500px; padding: 30px; border-radius: 40px 40px 0 0; animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }

        .type-selector { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin: 15px 0; }
        .t-btn { padding: 12px; border: 1.2px solid var(--border); border-radius: 15px; background: var(--bg); color: var(--text); font-size: 13px; font-weight: 600; }
        .t-btn.active { background: var(--primary); color: white; border-color: var(--primary); }

        .donate-box { display: flex; flex-direction: column; gap: 10px; margin-top: 15px; align-items: center; }
        .donate-box img { width: 180px; border-radius: 8px; }

        #toast { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background: #333; color: white; padding: 12px 25px; border-radius: 50px; font-size: 13px; opacity: 0; transition: 0.3s; z-index: 10001; }
        #toast.show { opacity: 1; bottom: 50px; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <!-- SPLASH SCREEN -->
    <div id="splash">
        <div class="splash-logo"><span class="material-icons-round" style="font-size: 50px;">event_note</span></div>
        <h1 style="font-size: 26px; font-weight: 700;">Duty Tracker Pro</h1>
        <div class="splash-footer">
            <div style="font-weight: 600; font-size: 15px;">Developer By Nitai Studio</div>
            <div class="made-in">Made in India <img src="https://flagcdn.com/w40/in.png" style="width: 22px; border-radius: 2px; margin-left: 5px;"></div>
        </div>
    </div>

    <!-- LOCK SCREEN -->
    <div id="lock-screen" class="hidden">
        <span class="material-icons-round" style="font-size: 80px; color: #E53935;">lock_clock</span>
        <h2 style="margin: 20px 0 10px;">Trial Period Ended</h2>
        <button class="btn-premium" style="max-width: 280px;" onclick="sub.pay()">Pay â‚¹10 to Unlock</button>
    </div>

    <!-- AUTH SCREEN -->
    <div id="auth-screen" class="hidden" style="flex:1; display:flex; align-items:center; justify-content:center; padding:30px;">
        <div style="width:100%; text-align:center;">
            <div class="splash-logo" style="margin: 0 auto 30px; background: var(--grad); color:white;"><span class="material-icons-round" style="font-size: 50px;">fingerprint</span></div>
            <h2>Get Started</h2>
            <input type="number" id="auth-phone" class="m-input" placeholder="Enter Mobile Number" style="text-align:center; margin-top:20px;">
            <button class="btn-premium" onclick="app.login()" style="margin-top:25px;">Login / Register</button>
        </div>
    </div>

    <!-- MAIN APP -->
    <div id="main-app" class="hidden">
        <header>
            <div class="header-top">
                <span class="material-icons-round" onclick="ui.togglePage('profile', true)">account_circle</span>
                <span id="trial-badge" class="sub-status">...</span>
                <span class="material-icons-round" onclick="ui.togglePage('reports', true)">insights</span>
            </div>
            <div class="month-bar">
                <button class="nav-btn" onclick="cal.move(-1)"><span class="material-icons-round">chevron_left</span></button>
                <h3 id="month-txt">Month 2026</h3>
                <button class="nav-btn" onclick="cal.move(1)"><span class="material-icons-round">chevron_right</span></button>
            </div>
            <div class="week-days"><div>SUN</div><div>MON</div><div>TUE</div><div>WED</div><div>THU</div><div>FRI</div><div>SAT</div></div>
        </header>
        <div id="calendar-grid"></div>
    </div>

    <!-- PROFILE PAGE -->
    <div id="profile" class="full-page">
        <div class="page-header"><span class="material-icons-round" onclick="ui.togglePage('profile', false)">arrow_back</span><h2 style="font-size:18px;">Profile & Support</h2></div>
        <div style="overflow-y:auto; flex:1; padding-bottom: 20px;">
            <div class="section-card" style="border: 2px solid var(--primary); background: var(--card-sub);">
                <h3 style="font-size: 14px; color: var(--primary);">ðŸ’Ž Premium Subscription</h3>
                <p id="sub-desc" style="font-size: 11px; margin: 5px 0 15px; opacity: 0.8;">Unlock all features forever.</p>
                <button class="btn-premium" onclick="sub.pay()">Subscribe - â‚¹10 / Month</button>
            </div>
            <div class="section-card">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <span style="font-weight: 600; font-size: 14px;">Dark Mode</span>
                    <span class="material-icons-round" id="theme-icon" onclick="settings.toggleTheme()" style="cursor:pointer; color:var(--primary); font-size: 30px;">light_mode</span>
                </div>
            </div>
            <div class="section-card">
                <h3 style="font-size: 14px; margin-bottom:10px;">Configuration</h3>
                <label style="font-size:11px; font-weight:700;">Currency</label>
                <select id="set-currency" class="m-input" onchange="settings.save()"><option value="à§³">à§³ BDT</option><option value="â‚¹">â‚¹ INR</option><option value="$">$ USD</option></select>
                <label style="font-size:11px; margin-top:10px; display:block; font-weight:700;">Daily Salary</label>
                <input type="number" id="set-salary" class="m-input" onchange="settings.save()">
                <label style="font-size:11px; margin-top:10px; display:block; font-weight:700;">OT Rate (Hour)</label>
                <input type="number" id="set-ot-rate" class="m-input" onchange="settings.save()">
            </div>
            <div class="section-card">
                <h3 style="font-size: 14px; text-align:center; margin-bottom:15px;">Support & Policies</h3>
                <div class="donate-box">
                    <a href="https://buymeacoffee.com/nitaigrp00a" target="_blank"><img src="https://img.shields.io/badge/Buy%20Me%20a%20Coffee-FFDD00?logo=buy-me-a-coffee&logoColor=black&style=for-the-badge"></a>
                    <a href="https://ko-fi.com/nitaisarkar" target="_blank"><img src="https://img.shields.io/badge/Ko--fi-Support%20Me-FF5E5B?logo=ko-fi&logoColor=white&style=for-the-badge"></a>
                    <a href="https://www.patreon.com/cw/NitaiStudio" target="_blank"><img src="https://img.shields.io/badge/Patreon-Support%20Me-F96854?logo=patreon&logoColor=white&style=for-the-badge"></a>
                </div>
                <div style="margin-top:20px;">
                    <div class="policy-item" onclick="window.open('https://nitaistudio.github.io/DutyTrackerPro/policies.html', '_blank')">Privacy Policy <span class="material-icons-round" style="font-size:18px;">open_in_new</span></div>
                    <div class="policy-item" onclick="ui.showPolicy('terms')">Terms & Conditions <span class="material-icons-round" style="font-size:18px;">chevron_right</span></div>
                    <div class="policy-item" onclick="ui.showPolicy('refund')">Refund Policy <span class="material-icons-round" style="font-size:18px;">chevron_right</span></div>
                </div>
                <p style="text-align:center; font-size:12px; margin-top:15px; opacity:0.7;">ðŸ“§ nitai.grp00@gmail.com</p>
            </div>
            <button onclick="localStorage.clear(); location.reload();" style="width:100%; color:red; border:none; background:none; padding:10px; font-weight:700;">LOGOUT</button>
        </div>
    </div>

    <!-- REPORTS -->
    <div id="reports" class="full-page">
        <div class="page-header"><span class="material-icons-round" onclick="ui.togglePage('reports', false)">arrow_back</span><h2 style="font-size:18px;">Earnings Summary</h2></div>
        <div style="padding:15px; overflow-y: auto;">
            <div class="section-card"><input type="date" id="r-start" class="m-input"><input type="date" id="r-end" class="m-input" style="margin-top:10px;"><button class="btn-premium" style="margin-top:15px;" onclick="reports.gen()">Calculate</button></div>
            <div id="r-out"></div>
        </div>
    </div>

    <!-- ENTRY MODAL -->
    <div id="modal-entry" class="modal">
        <div class="sheet">
            <h3 id="modal-date" style="text-align:center; color:var(--primary); font-weight:700; margin-bottom:20px;">Date</h3>
            <div class="type-selector">
                <button class="t-btn" data-t="Present" onclick="data.setType('Present', this)">Present</button>
                <button class="t-btn" data-t="Leave" onclick="data.setType('Leave', this)">Leave</button>
                <button class="t-btn" data-t="Sick" onclick="data.setType('Sick', this)">Sick</button>
                <button class="t-btn" data-t="Holiday" onclick="data.setType('Holiday', this)">Holiday</button>
                <button class="t-btn" data-t="Off" onclick="data.setType('Off', this)">Off Day</button>
            </div>
            <div style="display:flex; gap:15px; margin-bottom:5px;">
                <div style="flex:1;"><label style="font-size:10px; font-weight:600; margin-left:5px;">OT HOURS</label><input type="number" id="inp-ot" class="m-input" placeholder="0"></div>
                <div style="flex:1;"><label style="font-size:10px; font-weight:600; margin-left:5px;">LATE MINS</label><input type="number" id="inp-late" class="m-input" placeholder="0"></div>
            </div>
            <button class="btn-premium" style="margin-top:20px;" onclick="data.save()">Save Entry</button>
            
            <!-- FIXED CLEAR DATA BUTTON -->
            <div style="text-align:center; margin-top:25px;">
                <span onclick="data.clear()" style="color:#E53935; font-weight:700; font-size:15px; text-decoration:underline; cursor:pointer; padding: 10px; display: inline-block;">Clear Data</span>
            </div>
        </div>
    </div>

    <!-- POLICY MODAL -->
    <div id="modal-policy" class="modal">
        <div class="sheet">
            <h3 id="policy-title" style="color:var(--primary); margin-bottom:15px;">Policy</h3>
            <div id="policy-text" style="font-size:13px; line-height:1.6; color:var(--text); max-height:50vh; overflow-y:auto;"></div>
            <button class="btn-premium" style="margin-top:25px;" onclick="ui.closePolicy()">Close</button>
        </div>
    </div>

    <div id="toast">Message</div>

    <script>
        // CONFIG
        const firebaseConfig = {
            apiKey: "AIzaSyDxqq2PBqrtkTsygyMcIDOvZyx2_-x4QRk",
            authDomain: "duty-tracker-pro.firebaseapp.com",
            databaseURL: "https://duty-tracker-pro-default-rtdb.firebaseio.com",
            projectId: "duty-tracker-pro",
            storageBucket: "duty-tracker-pro.firebasestorage.app",
            messagingSenderId: "716525293622",
            appId: "1:716525293622:web:880f39084c86180fbb0897"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const s = { uid: null, date: new Date(), data: {}, conf: { ws: 0, wo: 0, cur: 'à§³', sal: 0, otr: 0, exp: 0 } };
        let sel = { d: null, t: null };

        const policies = {
            terms: `<b>Terms & Conditions</b><br><br>1. Duty Tracker Pro is a utility for personal work management.<br>2. Data is stored securely in Firebase.<br>3. Users are responsible for accurate data entry.<br>4. Subscription fees support app development.<br>5. We reserve the right to update terms.`,
            refund: `<b>Refund Policy</b><br><br>1. Subscription costs â‚¹10/month.<br>2. No refunds once payment is processed.<br>3. For payment issues, email nitai.grp00@gmail.com.`
        };

        window.onload = () => {
            const savedTheme = localStorage.getItem('dt_theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            document.getElementById('theme-icon').innerText = savedTheme === 'dark' ? 'dark_mode' : 'light_mode';
            setTimeout(() => {
                document.getElementById('splash').style.opacity = "0";
                setTimeout(() => document.getElementById('splash').classList.add('hidden'), 800);
                const id = localStorage.getItem('dt_id');
                if(id) app.start(id); else document.getElementById('auth-screen').classList.remove('hidden');
            }, 3000);
        };

        const app = {
            login: () => {
                const phone = document.getElementById('auth-phone').value.trim();
                if(phone.length < 10) return ui.toast("Invalid number");
                localStorage.setItem('dt_id', phone); app.start(phone);
            },
            start: (id) => {
                s.uid = id; document.getElementById('auth-screen').classList.add('hidden');
                document.getElementById('main-app').classList.remove('hidden');
                db.ref('u/'+id).on('value', snap => {
                    const v = snap.val();
                    if(v) { s.data = v.att || {}; s.conf = { ...s.conf, ...v.conf }; }
                    else { const trial = Date.now() + (3 * 24 * 60 * 60 * 1000); s.conf.exp = trial; db.ref(`u/${id}/conf`).set(s.conf); }
                    app.checkSub(); cal.render(); settings.updateUI();
                });
            },
            checkSub: () => {
                const diff = s.conf.exp - Date.now();
                const daysLeft = Math.ceil(diff / (1000 * 60 * 60 * 24));
                const badge = document.getElementById('trial-badge');
                if(daysLeft > 30) { badge.innerText = "PRO ACTIVE"; badge.style.background = "#4CAF50"; }
                else if (daysLeft > 0) { badge.innerText = `TRIAL: ${daysLeft} DAYS LEFT`; }
                else { document.getElementById('lock-screen').classList.remove('hidden'); document.getElementById('main-app').classList.add('hidden'); }
            }
        };

        const sub = {
            pay: () => {
                const options = {
                    key: "rzp_live_Rz7kQ4RAloCWGp", amount: 1000, currency: "INR", name: "Duty Tracker Pro",
                    description: "30 Days Extension",
                    handler: (res) => {
                        const curExp = s.conf.exp > Date.now() ? s.conf.exp : Date.now();
                        const newExp = curExp + (30 * 24 * 60 * 60 * 1000);
                        db.ref(`u/${s.uid}/conf/exp`).set(newExp).then(() => ui.toast("Activated!"));
                    }
                };
                new Razorpay(options).open();
            }
        };

        const cal = {
            getIso: (y, m, d) => `${y}-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`,
            render: () => {
                const y = s.date.getFullYear(), m = s.date.getMonth();
                document.getElementById('month-txt').innerText = new Date(y, m).toLocaleString('default', { month: 'long', year: 'numeric' });
                const grid = document.getElementById('calendar-grid'); grid.innerHTML = '';
                const fDay = new Date(y, m, 1).getDay(); const lDate = new Date(y, m+1, 0).getDate();
                for(let i=0; i<fDay; i++) grid.innerHTML += '<div></div>';
                const todayIso = new Date().toISOString().split('T')[0];
                for(let i=1; i<=lDate; i++) {
                    const iso = cal.getIso(y, m, i); const ent = s.data[iso];
                    const dObj = new Date(y, m, i);
                    const cell = document.createElement('div'); cell.className = 'day-cell';
                    if(dObj.getDay() === 0) cell.classList.add('day-sunday');
                    if(iso === todayIso) cell.classList.add('today');
                    if(ent && ent.t) cell.classList.add('bg-'+ent.t);
                    else if(dObj.getDay() === parseInt(s.conf.wo)) cell.classList.add('bg-Off');
                    cell.innerHTML = `<span class="day-num">${i}</span>` + (ent && ent.ot ? `<span class="badge-ot">OT: ${ent.ot}h</span>` : '');
                    cell.onclick = () => ui.open(iso, ent); grid.appendChild(cell);
                }
            },
            move: (v) => { s.date.setMonth(s.date.getMonth() + v); cal.render(); }
        };

        const data = {
            setType: (t, btn) => { sel.t = t; document.querySelectorAll('.t-btn').forEach(b => b.classList.remove('active')); btn.classList.add('active'); },
            save: () => {
                if(!sel.t) return ui.toast("Select status");
                const entry = { t: sel.t, ot: parseFloat(document.getElementById('inp-ot').value) || 0, lt: parseInt(document.getElementById('inp-late').value) || 0 };
                db.ref(`u/${s.uid}/att/${sel.d}`).set(entry).then(() => { ui.toast("Saved"); document.getElementById('modal-entry').classList.remove('show'); });
            },
            clear: () => { 
                if(!sel.d) return;
                // Remote Removal from Firebase
                db.ref(`u/${s.uid}/att/${sel.d}`).remove()
                .then(() => {
                    // Local State Update
                    if(s.data[sel.d]) delete s.data[sel.d];
                    cal.render();
                    ui.toast("Entry Cleared Successfully");
                    document.getElementById('modal-entry').classList.remove('show');
                })
                .catch(e => {
                    console.error(e);
                    ui.toast("Clear failed!");
                });
            }
        };

        const settings = {
            updateUI: () => {
                document.getElementById('set-currency').value = s.conf.cur || 'à§³';
                document.getElementById('set-salary').value = s.conf.sal || '';
                document.getElementById('set-ot-rate').value = s.conf.otr || '';
            },
            save: () => {
                s.conf.cur = document.getElementById('set-currency').value;
                s.conf.sal = parseFloat(document.getElementById('set-salary').value) || 0;
                s.conf.otr = parseFloat(document.getElementById('set-ot-rate').value) || 0;
                db.ref(`u/${s.uid}/conf`).update(s.conf); cal.render();
            },
            toggleTheme: () => {
                const target = document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
                document.documentElement.setAttribute('data-theme', target);
                localStorage.setItem('dt_theme', target);
                document.getElementById('theme-icon').innerText = target === 'dark' ? 'dark_mode' : 'light_mode';
            }
        };

        const reports = {
            gen: () => {
                const start = document.getElementById('r-start').value, end = document.getElementById('r-end').value;
                if(!start || !end) return ui.toast("Select dates");
                let pres=0, hol=0, sick=0, ot=0, late=0; const sDate = new Date(start), eDate = new Date(end);
                for(let d = new Date(sDate); d <= eDate; d.setDate(d.getDate()+1)) {
                    const iso = d.toISOString().split('T')[0]; const e = s.data[iso];
                    if(e) { if(e.t === 'Present') pres++; if(e.t === 'Holiday') hol++; if(e.t === 'Sick') sick++; ot += (e.ot || 0); late += (e.lt || 0); }
                }
                const paid = pres+hol+sick; const base = paid * s.conf.sal; const otS = ot * s.conf.otr;
                const grand = base + otS;
                const cur = s.conf.cur;
                document.getElementById('r-out').innerHTML = `
                    <div class="section-card" style="background: var(--grad); color: white; padding: 25px;">
                        <h2 style="font-size: 28px;">${cur} ${grand.toLocaleString()}</h2>
                        <div style="margin-top:15px; font-size:12px; border-top:1px solid rgba(255,255,255,0.2); padding-top:10px;">
                            <p style="display:flex; justify-content:space-between; margin-bottom:5px;"><span>Paid Days (P+H+S):</span> <span>${paid}</span></p>
                            <p style="display:flex; justify-content:space-between; margin-bottom:5px;"><span>Base Salary:</span> <span>${cur} ${base.toLocaleString()}</span></p>
                            <p style="display:flex; justify-content:space-between; margin-bottom:5px;"><span>OT Earnings:</span> <span>${cur} ${otS.toLocaleString()} (${ot}h)</span></p>
                            <p style="display:flex; justify-content:space-between;"><span>Total Late:</span> <span>${late} Mins</span></p>
                        </div>
                    </div>`;
            }
        };

        const ui = {
            open: (d, e) => {
                sel.d = d; sel.t = null; document.getElementById('modal-date').innerText = new Date(d).toDateString();
                document.getElementById('inp-ot').value = e ? e.ot : '0'; 
                document.getElementById('inp-late').value = e ? e.lt : '0';
                document.querySelectorAll('.t-btn').forEach(b => b.classList.remove('active'));
                if(e) data.setType(e.t, document.querySelector(`[data-t="${e.t}"]`));
                document.getElementById('modal-entry').classList.add('show');
            },
            showPolicy: (type) => {
                document.getElementById('policy-title').innerText = type === 'terms' ? 'Terms & Conditions' : 'Refund Policy';
                document.getElementById('policy-text').innerHTML = policies[type];
                document.getElementById('modal-policy').classList.add('show');
            },
            closePolicy: () => document.getElementById('modal-policy').classList.remove('show'),
            togglePage: (id, open) => {
                document.getElementById(id).classList.toggle('open', open);
                if(id === 'reports' && open) { document.getElementById('r-start').value = cal.getIso(s.date.getFullYear(), s.date.getMonth(), 1); document.getElementById('r-end').value = new Date().toISOString().split('T')[0]; }
            },
            toast: (m) => { const t = document.getElementById('toast'); t.innerText = m; t.classList.add('show'); setTimeout(() => t.classList.remove('show'), 2000); }
        };

        window.onclick = function(e){ if(e.target.classList.contains('modal')) e.target.classList.remove('show'); };
        if ('serviceWorker' in navigator) { window.addEventListener('load', () => { navigator.serviceWorker.register('./sw.js'); }); }
    </script>
</body>
</html>